[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-11-28 08:21:27.018539",
  "module": "galaxynext",
  "name": "sale order finish instruction",
  "script": "// frappe.ui.form.on(\"Sales Order\", {\r\n//     refresh: function(frm) {\r\n//         // Hide table initially\r\n//         frm.set_df_property(\"finishing_instruction\", \"hidden\", 1);\r\n\r\n//         // Hide extra columns\r\n//         if (frm.fields_dict.finishing_instruction) {\r\n//             frm.fields_dict.finishing_instruction.grid.toggle_display(\"status\", false);\r\n//             frm.fields_dict.finishing_instruction.grid.toggle_display(\"reference_item\", false);\r\n//         }\r\n\r\n//         // Add global CSS to hide edit options\r\n//         add_global_hide_css();\r\n\r\n//         // Setup event listeners\r\n//         setup_global_listeners(frm);\r\n        \r\n//         // **NEW: Prevent Tab from adding rows**\r\n//         prevent_tab_add_row(frm);\r\n//     }\r\n// });\r\n\r\n// frappe.ui.form.on(\"Sales Order Item\", {\r\n//     detail: function(frm, cdt, cdn) {\r\n//         var item = locals[cdt][cdn];\r\n//         if (!item) return;\r\n\r\n//         // Hide table for fresh view\r\n//         frm.set_df_property(\"finishing_instruction\", \"hidden\", 1);\r\n\r\n//         // Remove old header\r\n//         frm.fields_dict.finishing_instruction.$wrapper.find(\".finish-header\").remove();\r\n\r\n//         setTimeout(function() {\r\n//             // Show table for current item\r\n//             frm.set_df_property(\"finishing_instruction\", \"hidden\", 0);\r\n\r\n//             // Add item-specific header\r\n//             frm.fields_dict.finishing_instruction.$wrapper.prepend(\r\n//                 `<div class=\"finish-header\" style=\"font-weight:bold; margin:10px 0; font-size:14px; color:#007bff;\">\r\n//                     Finishing Instruction for Item: ${item.item_code} â€“ ${item.item_name || ''}\r\n//                 </div>`\r\n//             );\r\n\r\n//             // Check existing rows\r\n//             var existing_rows = frm.doc.finishing_instruction.filter(r => r.reference_item === item.item_code);\r\n\r\n//             if (existing_rows.length === 0) {\r\n//                 frappe.call({\r\n//                     method: \"frappe.client.get_list\",\r\n//                     args: {\r\n//                         doctype: \"MiscellaneousMst\",\r\n//                         filters: { trantype: \"TM-09-2025-00005\", status: \"true\" },\r\n//                         fields: [\"value\"]\r\n//                     },\r\n//                     callback: function(r) {\r\n//                         if (r.message && r.message.length > 0) {\r\n//                             r.message.forEach(d => {\r\n//                                 var row = frm.add_child(\"finishing_instruction\");\r\n//                                 row.finish_process = d.value;\r\n//                                 row.status = \"No\";\r\n//                                 row.value = \"\";\r\n//                                 row.reference_item = item.item_code;\r\n//                             });\r\n                            \r\n//                             frm.refresh_field(\"finishing_instruction\");\r\n                            \r\n//                             setTimeout(function() {\r\n//                                 customize_grid_headers(frm);\r\n//                                 filter_rows(frm, item.item_code);\r\n//                                 force_hide_edit_options(frm);\r\n//                                 prevent_tab_add_row(frm); // Re-apply\r\n//                             }, 300);\r\n//                         } else {\r\n//                             frappe.msgprint(__('No finishing processes found for this item.'));\r\n//                         }\r\n//                     }\r\n//                 });\r\n//             } else {\r\n//                 // **IMPORTANT: Rows exist, just show them**\r\n//                 frm.refresh_field(\"finishing_instruction\");\r\n                \r\n//                 setTimeout(function() {\r\n//                     customize_grid_headers(frm);\r\n//                     filter_rows(frm, item.item_code);\r\n//                     force_hide_edit_options(frm);\r\n//                     prevent_tab_add_row(frm); // Re-apply\r\n//                 }, 300);\r\n//             }\r\n//         }, 100);\r\n//     }\r\n// });\r\n\r\n// // **NEW: Prevent Tab key from adding new rows**\r\n// function prevent_tab_add_row(frm) {\r\n//     var grid = frm.fields_dict.finishing_instruction?.grid;\r\n//     if (!grid) return;\r\n    \r\n//     // Block add_new_row method\r\n//     grid.add_new_row = function() {\r\n//         return false;\r\n//     };\r\n    \r\n//     // Intercept Tab key\r\n//     $(grid.wrapper).off('keydown.prevent-tab');\r\n//     $(grid.wrapper).on('keydown.prevent-tab', 'input, textarea, select', function(e) {\r\n//         if (e.key === 'Tab' || e.keyCode === 9) {\r\n//             var $visible_inputs = $(grid.wrapper).find('.grid-row:visible input:visible, .grid-row:visible textarea:visible, .grid-row:visible select:visible');\r\n//             var current_index = $visible_inputs.index(this);\r\n            \r\n//             if (e.shiftKey) {\r\n//                 // Shift+Tab: Previous field\r\n//                 if (current_index > 0) {\r\n//                     e.preventDefault();\r\n//                     $visible_inputs.eq(current_index - 1).focus();\r\n//                 }\r\n//             } else {\r\n//                 // Tab: Next field\r\n//                 if (current_index < $visible_inputs.length - 1) {\r\n//                     e.preventDefault();\r\n//                     $visible_inputs.eq(current_index + 1).focus();\r\n//                 } else {\r\n//                     // Last field: just blur\r\n//                     e.preventDefault();\r\n//                     $(this).blur();\r\n//                 }\r\n//             }\r\n//         }\r\n//     });\r\n// }\r\n\r\n// // Hide grid buttons globally (CSS)\r\n// function add_global_hide_css() {\r\n//     if (!$('#finishing-instruction-hide-style').length) {\r\n//         $('head').append(`\r\n//             <style id=\"finishing-instruction-hide-style\">\r\n//                 .grid-form .btn:not(.btn-primary),\r\n//                 .grid-form button[data-action],\r\n//                 .grid-form .dropdown-toggle,\r\n//                 .grid-form .dropdown-menu,\r\n//                 .grid-form .btn-group > .btn:not(.btn-primary),\r\n//                 [data-fieldname=\"finishing_instruction\"] .grid-row .grid-row-check,\r\n//                 [data-fieldname=\"finishing_instruction\"] .grid-row input[type=\"checkbox\"],\r\n//                 [data-fieldname=\"finishing_instruction\"] .grid-footer .btn-danger,\r\n//                 [data-fieldname=\"finishing_instruction\"] .btn:contains(\"Delete\"),\r\n//                 .grid-row .btn-open-row,\r\n//                 .grid-row .row-actions,\r\n//                 .grid-row .grid-row-open,\r\n//                 .octicon-pencil,\r\n//                 .fa-pencil,\r\n//                 .fa-edit,\r\n//                 .fa-pen,\r\n//                 [data-fieldname=\"finishing_instruction\"] .grid-footer,\r\n//                 [data-fieldname=\"finishing_instruction\"] .grid-add-row\r\n//                 { display:none !important; visibility:hidden !important; }\r\n//             </style>\r\n//         `);\r\n//     }\r\n// }\r\n\r\n// // Setup global listeners\r\n// function setup_global_listeners(frm) {\r\n//     $(document).off('click.hide-grid-buttons show.bs.modal.hide-grid-buttons DOMNodeInserted.hide-grid-buttons');\r\n\r\n//     $(document).on('click.hide-grid-buttons', '[data-fieldname=\"finishing_instruction\"] .grid-row', hide_all_edit_buttons);\r\n//     $(document).on('show.bs.modal.hide-grid-buttons', '.grid-form', hide_all_edit_buttons);\r\n//     $(document).on('DOMNodeInserted.hide-grid-buttons', function(e) {\r\n//         if ($(e.target).hasClass('grid-form') || $(e.target).find('.grid-form').length) {\r\n//             setTimeout(hide_all_edit_buttons, 100);\r\n//         }\r\n//     });\r\n\r\n//     // Force grid permissions\r\n//     var grid = frm.fields_dict.finishing_instruction?.grid;\r\n//     if (grid) {\r\n//         grid.df.cannot_add_rows = 1;\r\n//         grid.df.cannot_delete_rows = 1;\r\n\r\n//         grid.docfields.forEach(df => {\r\n//             df.read_only = df.fieldname !== \"value\";\r\n//         });\r\n\r\n//         setTimeout(() => {\r\n//             $(grid.wrapper).find('.grid-footer, .grid-add-row, .grid-row-check, .btn-open-row, .row-actions, .grid-row-open').hide();\r\n//         }, 100);\r\n//     }\r\n// }\r\n\r\n// // Hide all edit buttons function\r\n// function hide_all_edit_buttons() {\r\n//     $('.grid-form button, .grid-form .dropdown-toggle, .grid-form .dropdown-menu').hide();\r\n// }\r\n\r\n// // **FIXED: Filter rows - show matched rows properly**\r\n// function filter_rows(frm, item_code) {\r\n//     var grid = frm.fields_dict.finishing_instruction.grid;\r\n//     if (!grid) return;\r\n    \r\n//     var counter = 1;\r\n//     var found_rows = false;\r\n\r\n//     // Show header\r\n//     grid.wrapper.find('.grid-heading-row').show();\r\n    \r\n//     // Hide all rows first\r\n//     grid.wrapper.find('.grid-row').each(function() {\r\n//         $(this).hide();\r\n//     });\r\n\r\n//     // Show matching rows\r\n//     grid.wrapper.find('.grid-row').each(function() {\r\n//         var idx = $(this).attr('data-idx');\r\n//         var row = frm.doc.finishing_instruction.find(r => r.idx == idx);\r\n        \r\n//         if (row && row.reference_item === item_code) {\r\n//             $(this).show();\r\n//             $(this).find(\".row-index\").text(counter++);\r\n//             found_rows = true;\r\n//         }\r\n//     });\r\n    \r\n//     // If no rows found, show message\r\n//     if (!found_rows) {\r\n//         grid.wrapper.find('.grid-empty').show();\r\n//     } else {\r\n//         grid.wrapper.find('.grid-empty').hide();\r\n//     }\r\n\r\n//     if (grid.grid_pagination) grid.grid_pagination.refresh();\r\n// }\r\n\r\n// // **IMPROVED: Force hide edit options**\r\n// function force_hide_edit_options(frm) {\r\n//     var grid = frm.fields_dict.finishing_instruction?.grid;\r\n//     if (!grid) return;\r\n    \r\n//     setTimeout(() => {\r\n//         $(grid.wrapper).find('.grid-footer, .grid-add-row, .grid-row-check, .btn-open-row, .row-actions, .grid-row-open, button:not(.btn-primary)').hide();\r\n//         hide_all_edit_buttons();\r\n//     }, 100);\r\n// }\r\n\r\n// // Customize grid headers\r\n// function customize_grid_headers(frm) {\r\n//     var grid = frm.fields_dict.finishing_instruction.grid;\r\n//     setTimeout(() => {\r\n//         if (grid.docfields) {\r\n//             grid.docfields.forEach(df => {\r\n//                 if (df.fieldname === 'finish_process') df.label = 'Finishing Process';\r\n//                 if (df.fieldname === 'value') df.label = 'Value';\r\n//             });\r\n//         }\r\n//         if (grid.refresh_header) grid.refresh_header();\r\n//         grid.refresh();\r\n//     }, 150);\r\n// }\r\n\r\n// // Cleanup on page unload\r\n// $(window).on('beforeunload', function() {\r\n//     $(document).off('click.hide-grid-buttons show.bs.modal.hide-grid-buttons DOMNodeInserted.hide-grid-buttons');\r\n//     $('[data-fieldname=\"finishing_instruction\"]').off('keydown.prevent-tab');\r\n// });\r\n\r\n\r\n\r\n\r\n\r\nfrappe.ui.form.on(\"Sales Order\", {\r\n    refresh: function(frm) {\r\n        // Hide table initially\r\n        frm.set_df_property(\"finishing_instruction\", \"hidden\", 1);\r\n\r\n        // Hide extra columns\r\n        if (frm.fields_dict.finishing_instruction) {\r\n            frm.fields_dict.finishing_instruction.grid.toggle_display(\"status\", false);\r\n            frm.fields_dict.finishing_instruction.grid.toggle_display(\"reference_item\", false);\r\n        }\r\n\r\n        // Add global CSS to hide edit options\r\n        add_global_hide_css();\r\n\r\n        // Setup event listeners\r\n        setup_global_listeners(frm);\r\n        \r\n        // **NEW: Prevent Tab from adding rows**\r\n        prevent_tab_add_row(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on(\"Sales Order Item\", {\r\n    detail: function(frm, cdt, cdn) {\r\n        var item = locals[cdt][cdn];\r\n        if (!item) return;\r\n\r\n        // Hide table for fresh view\r\n        frm.set_df_property(\"finishing_instruction\", \"hidden\", 1);\r\n\r\n        // Remove old header\r\n        frm.fields_dict.finishing_instruction.$wrapper.find(\".finish-header\").remove();\r\n\r\n        setTimeout(function() {\r\n            // Show table for current item\r\n            frm.set_df_property(\"finishing_instruction\", \"hidden\", 0);\r\n\r\n            // Add item-specific header\r\n            frm.fields_dict.finishing_instruction.$wrapper.prepend(\r\n                `<div class=\"finish-header\" style=\"font-weight:bold; margin:10px 0; font-size:14px; color:#007bff;\">\r\n                    Finishing Instruction for Item: ${item.item_code} â€“ ${item.item_name || ''}\r\n                </div>`\r\n            );\r\n\r\n            // Check existing rows\r\n            var existing_rows = frm.doc.finishing_instruction.filter(r => r.reference_item === item.item_code);\r\n\r\n            if (existing_rows.length === 0) {\r\n                frappe.call({\r\n                    method: \"frappe.client.get_list\",\r\n                    args: {\r\n                        doctype: \"MiscellaneousMst\",\r\n                        filters: { trantype: \"TM-09-2025-00005\", status: \"true\" },\r\n                        fields: [\"value\"]\r\n                    },\r\n                    callback: function(r) {\r\n                        if (r.message && r.message.length > 0) {\r\n                            r.message.forEach(d => {\r\n                                var row = frm.add_child(\"finishing_instruction\");\r\n                                row.finish_process = d.value;\r\n                                row.status = \"No\";\r\n                                row.value = \"\";\r\n                                row.reference_item = item.item_code;\r\n                            });\r\n                            \r\n                            frm.refresh_field(\"finishing_instruction\");\r\n                            \r\n                            setTimeout(function() {\r\n                                customize_grid_headers(frm);\r\n                                filter_rows(frm, item.item_code);\r\n                                force_hide_edit_options(frm);\r\n                                prevent_tab_add_row(frm); // Re-apply\r\n                            }, 300);\r\n                        } else {\r\n                            frappe.msgprint(__('No finishing processes found for this item.'));\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                // **IMPORTANT: Rows exist, just show them**\r\n                frm.refresh_field(\"finishing_instruction\");\r\n                \r\n                setTimeout(function() {\r\n                    customize_grid_headers(frm);\r\n                    filter_rows(frm, item.item_code);\r\n                    force_hide_edit_options(frm);\r\n                    prevent_tab_add_row(frm); // Re-apply\r\n                }, 300);\r\n            }\r\n        }, 100);\r\n    }\r\n});\r\n\r\n// **IMPROVED: Tab navigation to next row's Value field with edit mode**\r\nfunction prevent_tab_add_row(frm) {\r\n    var grid = frm.fields_dict.finishing_instruction?.grid;\r\n    if (!grid) return;\r\n    \r\n    // Block add_new_row method\r\n    grid.add_new_row = function() {\r\n        return false;\r\n    };\r\n    \r\n    // Intercept Tab key for smart navigation\r\n    $(grid.wrapper).off('keydown.prevent-tab');\r\n    $(grid.wrapper).on('keydown.prevent-tab', '[data-fieldname=\"value\"] input, [data-fieldname=\"value\"] .static-area', function(e) {\r\n        if (e.key === 'Tab' || e.keyCode === 9) {\r\n            e.preventDefault();\r\n            \r\n            var $current_row = $(this).closest('.grid-row');\r\n            var $all_visible_rows = $(grid.wrapper).find('.grid-row:visible');\r\n            var current_row_index = $all_visible_rows.index($current_row);\r\n            \r\n            var target_row_index = e.shiftKey ? current_row_index - 1 : current_row_index + 1;\r\n            var $target_row = $all_visible_rows.eq(target_row_index);\r\n            \r\n            if ($target_row.length) {\r\n                var target_idx = $target_row.attr('data-idx');\r\n                var target_doc = frm.doc.finishing_instruction.find(r => r.idx == target_idx);\r\n                \r\n                if (target_doc) {\r\n                    // Open the row for editing using grid's method\r\n                    setTimeout(function() {\r\n                        grid.open_grid_row();\r\n                        grid.grid_rows.forEach(function(grid_row) {\r\n                            if (grid_row.doc.idx == target_idx) {\r\n                                grid_row.toggle_view(true); // Open the row\r\n                                \r\n                                setTimeout(function() {\r\n                                    // Find and focus the value field\r\n                                    var $value_input = $target_row.find('[data-fieldname=\"value\"] input');\r\n                                    if ($value_input.length) {\r\n                                        $value_input.focus();\r\n                                        $value_input.select();\r\n                                    } else {\r\n                                        // Try clicking the field to activate it\r\n                                        var $value_field = $target_row.find('[data-fieldname=\"value\"]');\r\n                                        $value_field.click();\r\n                                        setTimeout(function() {\r\n                                            $target_row.find('[data-fieldname=\"value\"] input').focus().select();\r\n                                        }, 100);\r\n                                    }\r\n                                }, 100);\r\n                            }\r\n                        });\r\n                    }, 50);\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n// Hide grid buttons globally (CSS)\r\nfunction add_global_hide_css() {\r\n    if (!$('#finishing-instruction-hide-style').length) {\r\n        $('head').append(`\r\n            <style id=\"finishing-instruction-hide-style\">\r\n                .grid-form .btn:not(.btn-primary),\r\n                .grid-form button[data-action],\r\n                .grid-form .dropdown-toggle,\r\n                .grid-form .dropdown-menu,\r\n                .grid-form .btn-group > .btn:not(.btn-primary),\r\n                [data-fieldname=\"finishing_instruction\"] .grid-row .grid-row-check,\r\n                [data-fieldname=\"finishing_instruction\"] .grid-row input[type=\"checkbox\"],\r\n                [data-fieldname=\"finishing_instruction\"] .grid-footer .btn-danger,\r\n                [data-fieldname=\"finishing_instruction\"] .btn:contains(\"Delete\"),\r\n                .grid-row .btn-open-row,\r\n                .grid-row .row-actions,\r\n                .grid-row .grid-row-open,\r\n                .octicon-pencil,\r\n                .fa-pencil,\r\n                .fa-edit,\r\n                .fa-pen,\r\n                [data-fieldname=\"finishing_instruction\"] .grid-footer,\r\n                [data-fieldname=\"finishing_instruction\"] .grid-add-row\r\n                { display:none !important; visibility:hidden !important; }\r\n            </style>\r\n        `);\r\n    }\r\n}\r\n\r\n// Setup global listeners\r\nfunction setup_global_listeners(frm) {\r\n    $(document).off('click.hide-grid-buttons show.bs.modal.hide-grid-buttons DOMNodeInserted.hide-grid-buttons');\r\n\r\n    $(document).on('click.hide-grid-buttons', '[data-fieldname=\"finishing_instruction\"] .grid-row', hide_all_edit_buttons);\r\n    $(document).on('show.bs.modal.hide-grid-buttons', '.grid-form', hide_all_edit_buttons);\r\n    $(document).on('DOMNodeInserted.hide-grid-buttons', function(e) {\r\n        if ($(e.target).hasClass('grid-form') || $(e.target).find('.grid-form').length) {\r\n            setTimeout(hide_all_edit_buttons, 100);\r\n        }\r\n    });\r\n\r\n    // Force grid permissions\r\n    var grid = frm.fields_dict.finishing_instruction?.grid;\r\n    if (grid) {\r\n        grid.df.cannot_add_rows = 1;\r\n        grid.df.cannot_delete_rows = 1;\r\n\r\n        grid.docfields.forEach(df => {\r\n            df.read_only = df.fieldname !== \"value\";\r\n        });\r\n\r\n        setTimeout(() => {\r\n            $(grid.wrapper).find('.grid-footer, .grid-add-row, .grid-row-check, .btn-open-row, .row-actions, .grid-row-open').hide();\r\n        }, 100);\r\n    }\r\n}\r\n\r\n// Hide all edit buttons function\r\nfunction hide_all_edit_buttons() {\r\n    $('.grid-form button, .grid-form .dropdown-toggle, .grid-form .dropdown-menu').hide();\r\n}\r\n\r\n// **FIXED: Filter rows - show matched rows properly**\r\nfunction filter_rows(frm, item_code) {\r\n    var grid = frm.fields_dict.finishing_instruction.grid;\r\n    if (!grid) return;\r\n    \r\n    var counter = 1;\r\n    var found_rows = false;\r\n\r\n    // Show header\r\n    grid.wrapper.find('.grid-heading-row').show();\r\n    \r\n    // Hide all rows first\r\n    grid.wrapper.find('.grid-row').each(function() {\r\n        $(this).hide();\r\n    });\r\n\r\n    // Show matching rows\r\n    grid.wrapper.find('.grid-row').each(function() {\r\n        var idx = $(this).attr('data-idx');\r\n        var row = frm.doc.finishing_instruction.find(r => r.idx == idx);\r\n        \r\n        if (row && row.reference_item === item_code) {\r\n            $(this).show();\r\n            $(this).find(\".row-index\").text(counter++);\r\n            found_rows = true;\r\n        }\r\n    });\r\n    \r\n    // If no rows found, show message\r\n    if (!found_rows) {\r\n        grid.wrapper.find('.grid-empty').show();\r\n    } else {\r\n        grid.wrapper.find('.grid-empty').hide();\r\n    }\r\n\r\n    if (grid.grid_pagination) grid.grid_pagination.refresh();\r\n}\r\n\r\n// **IMPROVED: Force hide edit options**\r\nfunction force_hide_edit_options(frm) {\r\n    var grid = frm.fields_dict.finishing_instruction?.grid;\r\n    if (!grid) return;\r\n    \r\n    setTimeout(() => {\r\n        $(grid.wrapper).find('.grid-footer, .grid-add-row, .grid-row-check, .btn-open-row, .row-actions, .grid-row-open, button:not(.btn-primary)').hide();\r\n        hide_all_edit_buttons();\r\n    }, 100);\r\n}\r\n\r\n// Customize grid headers\r\nfunction customize_grid_headers(frm) {\r\n    var grid = frm.fields_dict.finishing_instruction.grid;\r\n    setTimeout(() => {\r\n        if (grid.docfields) {\r\n            grid.docfields.forEach(df => {\r\n                if (df.fieldname === 'finish_process') df.label = 'Finishing Process';\r\n                if (df.fieldname === 'value') df.label = 'Value';\r\n            });\r\n        }\r\n        if (grid.refresh_header) grid.refresh_header();\r\n        grid.refresh();\r\n    }, 150);\r\n}\r\n\r\n// Cleanup on page unload\r\n$(window).on('beforeunload', function() {\r\n    $(document).off('click.hide-grid-buttons show.bs.modal.hide-grid-buttons DOMNodeInserted.hide-grid-buttons');\r\n    $('[data-fieldname=\"finishing_instruction\"]').off('keydown.prevent-tab');\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-08-23 12:02:04.981672",
  "module": null,
  "name": "customer testing script",
  "script": " frappe.ui.form.on('Customer', {\r\n    test_value_1: function(frm) {\r\n        // àªœàª¯àª¾àª°à«‡ Test Value 1 change àª¥àª¾àª¯\r\n        frappe.show_alert({\r\n            message: __('You typed: {0}', [frm.doc.test_value_1]),\r\n            indicator: 'blue'\r\n        }, 5);\r\n    },\r\n\r\n    test_value_2: function(frm) {\r\n        // Test Value 2 change àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ Test Value 1 auto update\r\n        if (frm.doc.test_value_2) {\r\n            frm.set_value('test_value_1', frm.doc.test_value_2.toUpperCase());\r\n            frappe.msgprint(__('Test Value 1 auto-filled with UPPERCASE of Test Value 2'));\r\n        }\r\n    }\r\n});\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2025-08-23 13:02:09.588259",
  "module": null,
  "name": "supplier testing script",
  "script": "frappe.ui.form.on('Supplier', {\r\n    test_value_1: function(frm) {\r\n        // àªœàª¯àª¾àª°à«‡ Test Value 1 change àª¥àª¾àª¯\r\n        frappe.show_alert({\r\n            message: __('You typed: {0}', [frm.doc.test_value_1]),\r\n            indicator: 'blue'\r\n        }, 5);\r\n    },\r\n\r\n    test_value_2: function(frm) {\r\n        // Test Value 2 change àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ Test Value 1 auto update\r\n        if (frm.doc.test_value_2) {\r\n            frm.set_value('test_value_1', frm.doc.test_value_2.toUpperCase());\r\n            frappe.msgprint(__('Test Value 1 auto-filled with UPPERCASE of Test Value 2'));\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-08-22 12:21:57.376979",
  "module": null,
  "name": "project script",
  "script": "frappe.ui.form.on('Project', {\r\n    refresh(frm) {\r\n        // Add a label highlight effect\r\n        frm.fields_dict.client_name.$wrapper.css({\r\n            'background-color': '#e0ffe0',\r\n            'font-weight': 'bold'\r\n        });\r\n\r\n        // Automatically set a field if empty\r\n        if (!frm.doc.client_name) {\r\n            frm.set_value('client_name', 'Auto-filled by script');\r\n            frappe.show_alert({ \r\n                message: __('Client Name auto-filled'), \r\n                indicator: 'green' \r\n            });\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Campaign",
  "enabled": 1,
  "modified": "2025-08-25 15:08:52.904598",
  "module": "galaxynext",
  "name": "campaign client script",
  "script": "frappe.ui.form.on(\"Campaign\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Prospect",
  "enabled": 1,
  "modified": "2025-08-26 15:04:54.971402",
  "module": null,
  "name": "prospect client script",
  "script": "frappe.ui.form.on(\"Prospect\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2025-08-25 16:26:07.133879",
  "module": null,
  "name": "opportunity client script",
  "script": "frappe.ui.form.on(\"Opportunity\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-08-26 15:03:09.029573",
  "module": null,
  "name": "lead client script",
  "script": "frappe.ui.form.on(\"Lead\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Contract",
  "enabled": 1,
  "modified": "2025-08-25 16:43:11.309979",
  "module": null,
  "name": "contract client script",
  "script": "frappe.ui.form.on(\"Contract\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-09 15:07:28.946656",
  "module": "galaxynext",
  "name": "auto fill sale order",
  "script": "// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // âœ… Make po_no field clickable to open Subcontracting Order\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // Show button only if document is new (not saved yet)\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 return { filters: { is_internal_customer: 1 } };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: d.get_value(\"customer_company\")\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n//                         // Fetch Subcontracting Order\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 // Get Supplier Company first\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         // âœ… Set ALL main fields from Subcontracting Order\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name); // SC-ORD-2025-00020\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n//                                         // âœ… Store additional data in console for reference (not shown in form)\r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         // Clear existing items\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         // Process each item\r\n//                                         items.forEach((item) => {\r\n//                                             // Get correct warehouse for this company\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     // Add item row\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     // âœ… Refresh ALL fields after all items loaded\r\n//                                                     if (processed === items.length) {\r\n//                                                         // Refresh both header fields and items table\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         // âœ… Final data check in console\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // âœ… Make po_no field clickable to open Subcontracting Order\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // Show button only if document is new (not saved yet)\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Company, Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         {\r\n//                             label: 'Select Company',\r\n//                             fieldname: 'selected_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             reqd: 1,\r\n//                             onchange: () => {\r\n//                                 // Clear customer and subcontracting order when company changes\r\n//                                 d.set_value('customer', '');\r\n//                                 d.set_value('customer_company', '');\r\n//                                 d.set_value('subcontracting_order', '');\r\n                                \r\n//                                 // Refresh customer field to apply new filters\r\n//                                 d.fields_dict.customer.get_query = () => {\r\n//                                     let selected_company = d.get_value('selected_company');\r\n//                                     return {\r\n//                                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                         filters: {\r\n//                                             company: selected_company\r\n//                                         }\r\n//                                     };\r\n//                                 };\r\n//                                 d.fields_dict.customer.refresh();\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let selected_company = d.get_value('selected_company');\r\n//                                 if (!selected_company) {\r\n//                                     frappe.msgprint(__('Please select a company first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                     filters: {\r\n//                                         company: selected_company\r\n//                                     }\r\n//                                 };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let customer_company = d.get_value(\"customer_company\");\r\n//                                 if (!customer_company) {\r\n//                                     frappe.msgprint(__('Please select a customer first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: customer_company\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n//                         // Fetch Subcontracting Order\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 // Get Supplier Company first\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         // âœ… Verify that selected company matches supplier company\r\n//                                         if (supplier_company !== values.selected_company) {\r\n//                                             frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         // âœ… Set ALL main fields from Subcontracting Order\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name);\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n//                                         // âœ… Store additional data in console for reference\r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         // Clear existing items\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         // Process each item\r\n//                                         items.forEach((item) => {\r\n//                                             // Get correct warehouse for this company\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     // Add item row\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     // âœ… Refresh ALL fields after all items loaded\r\n//                                                     if (processed === items.length) {\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         // âœ… Final data check in console\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // âœ… Make po_no field clickable to open Subcontracting Order\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // Show button only if document is new (not saved yet)\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Company, Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         {\r\n//                             label: 'Select Company',\r\n//                             fieldname: 'selected_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             reqd: 1,\r\n//                             onchange: () => {\r\n//                                 // Clear customer and subcontracting order when company changes\r\n//                                 d.set_value('customer', '');\r\n//                                 d.set_value('customer_company', '');\r\n//                                 d.set_value('subcontracting_order', '');\r\n                                \r\n//                                 // Refresh customer field to apply new filters\r\n//                                 d.fields_dict.customer.get_query = () => {\r\n//                                     let selected_company = d.get_value('selected_company');\r\n//                                     return {\r\n//                                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                         filters: {\r\n//                                             company: selected_company\r\n//                                         }\r\n//                                     };\r\n//                                 };\r\n//                                 d.fields_dict.customer.refresh();\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let selected_company = d.get_value('selected_company');\r\n//                                 if (!selected_company) {\r\n//                                     frappe.msgprint(__('Please select a company first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                     filters: {\r\n//                                         company: selected_company\r\n//                                     }\r\n//                                 };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let customer_company = d.get_value(\"customer_company\");\r\n//                                 if (!customer_company) {\r\n//                                     frappe.msgprint(__('Please select a customer first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: customer_company\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n//                         // Fetch Subcontracting Order\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 // Get Supplier Company first\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         // âœ… Verify that selected company matches supplier company\r\n//                                         if (supplier_company !== values.selected_company) {\r\n//                                             frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         // âœ… Set ALL main fields from Subcontracting Order\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name);\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n//                                         // âœ… Store additional data in console for reference\r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         // Clear existing items\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         // Process each item\r\n//                                         items.forEach((item) => {\r\n//                                             // Get correct warehouse for this company\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     // Add item row\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     // âœ… Refresh ALL fields after all items loaded\r\n//                                                     if (processed === items.length) {\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         // âœ… Final data check in console\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n// -----------------------------button disable--------------------------------------------------------\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // ============================================\r\n//         // FEATURE 1: Make PO Number clickable to open Subcontracting Order\r\n//         // ============================================\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             // Make the field look clickable\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n            \r\n//             // Add click event to open Subcontracting Order form\r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // ============================================\r\n//         // FEATURE 2: Load From Subcontracting Button\r\n//         // Only show for new, unsaved Sales Orders\r\n//         // ============================================\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n                \r\n//                 // Step 1: Check if data already loaded (prevent duplicate loading)\r\n//                 if (frm._subcontracting_loaded) {\r\n//                     frappe.msgprint({\r\n//                         title: __('Already Loaded'),\r\n//                         message: __('Data has already been loaded from Subcontracting Order. Please refresh the page to load again.'),\r\n//                         indicator: 'orange'\r\n//                     });\r\n//                     return;\r\n//                 }\r\n\r\n//                 // Step 2: Create dialog with 4 fields\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Company, Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         // ============================================\r\n//                         // FIELD 1: Company Selection\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Select Company',\r\n//                             fieldname: 'selected_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             reqd: 1,\r\n//                             onchange: () => {\r\n//                                 // When company changes, clear dependent fields\r\n//                                 d.set_value('customer', '');\r\n//                                 d.set_value('customer_company', '');\r\n//                                 d.set_value('subcontracting_order', '');\r\n                                \r\n//                                 // Update customer dropdown filter based on selected company\r\n//                                 d.fields_dict.customer.get_query = () => {\r\n//                                     let selected_company = d.get_value('selected_company');\r\n//                                     return {\r\n//                                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                         filters: {\r\n//                                             company: selected_company\r\n//                                         }\r\n//                                     };\r\n//                                 };\r\n//                                 d.fields_dict.customer.refresh();\r\n//                             }\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 2: Internal Customer Selection\r\n//                         // Shows only customers allowed to transact with selected company\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let selected_company = d.get_value('selected_company');\r\n                                \r\n//                                 // Validate: Company must be selected first\r\n//                                 if (!selected_company) {\r\n//                                     frappe.msgprint(__('Please select a company first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 // Filter customers based on \"Allowed To Transact With\" table\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                     filters: {\r\n//                                         company: selected_company\r\n//                                     }\r\n//                                 };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n                                \r\n//                                 // Fetch and set customer's company\r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 3: Customer Company (Read-only)\r\n//                         // Auto-populated from customer's \"represents_company\" field\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 4: Subcontracting Order Selection\r\n//                         // Shows only orders from customer's company that aren't used yet\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let customer_company = d.get_value(\"customer_company\");\r\n                                \r\n//                                 // Validate: Customer must be selected first\r\n//                                 if (!customer_company) {\r\n//                                     frappe.msgprint(__('Please select a customer first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 // Get available subcontracting orders (not used in any Sales Order)\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: customer_company\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n                    \r\n//                     // ============================================\r\n//                     // PRIMARY ACTION: Load Data Button\r\n//                     // ============================================\r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n                        \r\n//                         // Step 1: Fetch complete Subcontracting Order document\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 // Step 2: Get supplier's company\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         // Validation: Supplier must have a company\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         // Validation: Selected company must match supplier's company\r\n//                                         if (supplier_company !== values.selected_company) {\r\n//                                             frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         // ============================================\r\n//                                         // Step 3: Set Sales Order header fields\r\n//                                         // ============================================\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name);  // Customer's PO Number = SC Order ID\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n//                                         // Log full subcontracting data for debugging\r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         // ============================================\r\n//                                         // Step 4: Clear existing items and prepare to load new ones\r\n//                                         // ============================================\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         // Check if items exist\r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         // ============================================\r\n//                                         // Step 5: Process each item from Subcontracting Order\r\n//                                         // ============================================\r\n//                                         items.forEach((item) => {\r\n//                                             // Get correct warehouse for this item and company\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     // Add new item row to Sales Order\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     // ============================================\r\n//                                                     // Step 6: After all items loaded, refresh form\r\n//                                                     // ============================================\r\n//                                                     if (processed === items.length) {\r\n//                                                         // Refresh all fields to show loaded data\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         // Mark as loaded to prevent duplicate loading\r\n//                                                         frm._subcontracting_loaded = true;\r\n                                                        \r\n//                                                         // Show success message\r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         // Log final loaded data for verification\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         // Close dialog after processing\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 // Show the dialog\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n// ------------------------------------------------working code ----------------------------------------------------\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // ============================================\r\n//         // FEATURE 1: Make PO Number clickable to open Subcontracting Order\r\n//         // ============================================\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             // Make the field look clickable\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n            \r\n//             // Add click event to open Subcontracting Order form\r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // ============================================\r\n//         // FEATURE 2: Load From Subcontracting Button\r\n//         // Only show for new, unsaved Sales Orders\r\n//         // ============================================\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n                \r\n//                 // Step 1: Check if data already loaded (prevent duplicate loading)\r\n//                 if (frm._subcontracting_loaded) {\r\n//                     frappe.msgprint({\r\n//                         title: __('Already Loaded'),\r\n//                         message: __('Data has already been loaded from Subcontracting Order. Please refresh the page to load again.'),\r\n//                         indicator: 'orange'\r\n//                     });\r\n//                     return;\r\n//                 }\r\n\r\n//                 // Step 2: Create dialog with 4 fields\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Company, Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         // ============================================\r\n//                         // FIELD 1: Company Selection\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Select Company',\r\n//                             fieldname: 'selected_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             reqd: 1,\r\n//                             onchange: () => {\r\n//                                 // When company changes, clear dependent fields\r\n//                                 d.set_value('customer', '');\r\n//                                 d.set_value('customer_company', '');\r\n//                                 d.set_value('subcontracting_order', '');\r\n                                \r\n//                                 // Update customer dropdown filter based on selected company\r\n//                                 d.fields_dict.customer.get_query = () => {\r\n//                                     let selected_company = d.get_value('selected_company');\r\n//                                     return {\r\n//                                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                         filters: {\r\n//                                             company: selected_company\r\n//                                         }\r\n//                                     };\r\n//                                 };\r\n//                                 d.fields_dict.customer.refresh();\r\n//                             }\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 2: Internal Customer Selection\r\n//                         // Shows only customers allowed to transact with selected company\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let selected_company = d.get_value('selected_company');\r\n                                \r\n//                                 // Validate: Company must be selected first\r\n//                                 if (!selected_company) {\r\n//                                     frappe.msgprint(__('Please select a company first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 // Filter customers based on \"Allowed To Transact With\" table\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                     filters: {\r\n//                                         company: selected_company\r\n//                                     }\r\n//                                 };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n                                \r\n//                                 // Fetch and set customer's company\r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 3: Customer Company (Read-only)\r\n//                         // Auto-populated from customer's \"represents_company\" field\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n                        \r\n//                         // ============================================\r\n//                         // FIELD 4: Subcontracting Order Selection\r\n//                         // Shows only orders from customer's company that aren't used yet\r\n//                         // ============================================\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let customer_company = d.get_value(\"customer_company\");\r\n                                \r\n//                                 // Validate: Customer must be selected first\r\n//                                 if (!customer_company) {\r\n//                                     frappe.msgprint(__('Please select a customer first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 // Get available subcontracting orders (not used in any Sales Order)\r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: customer_company\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n                    \r\n//                     // ============================================\r\n//                     // PRIMARY ACTION: Load Data Button\r\n//                     // ============================================\r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n                        \r\n//                         // Step 1: Fetch complete Subcontracting Order document\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 // Step 2: Get supplier's company\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         // Validation: Supplier must have a company\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         // Validation: Selected company must match supplier's company\r\n//                                         if (supplier_company !== values.selected_company) {\r\n//                                             frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         // ============================================\r\n//                                         // Step 3: Set Sales Order header fields\r\n//                                         // ============================================\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name);  // Customer's PO Number = SC Order ID\r\n//                                         frm.set_value(\"po_date\", sco.transaction_date);  // Customer's PO Date\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);  // Delivery Date\r\n                                        \r\n//                                         // Log full subcontracting data for debugging\r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         // ============================================\r\n//                                         // Step 4: Clear existing items and prepare to load new ones\r\n//                                         // ============================================\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         // Check if items exist\r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         // ============================================\r\n//                                         // Step 5: Process each item from Subcontracting Order\r\n//                                         // ============================================\r\n//                                         items.forEach((item) => {\r\n//                                             // Get correct warehouse for this item and company\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     // Add new item row to Sales Order\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     // ============================================\r\n//                                                     // Step 6: After all items loaded, refresh form\r\n//                                                     // ============================================\r\n//                                                     if (processed === items.length) {\r\n//                                                         // Refresh all fields to show loaded data\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"po_date\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         // Mark as loaded to prevent duplicate loading\r\n//                                                         frm._subcontracting_loaded = true;\r\n                                                        \r\n//                                                         // Show success message\r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         // Log final loaded data for verification\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             po_date: frm.doc.po_date,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         // Close dialog after processing\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 // Show the dialog\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // ============================================\r\n//         // FEATURE 1: Make PO Number clickable to open Subcontracting Order\r\n//         // ============================================\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n            \r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // ============================================\r\n//         // FEATURE 2: Load From Subcontracting Button\r\n//         // ============================================\r\n//         if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n                \r\n//                 if (frm._subcontracting_loaded) {\r\n//                     frappe.msgprint({\r\n//                         title: __('Already Loaded'),\r\n//                         message: __('Data has already been loaded from Subcontracting Order. Please refresh the page to load again.'),\r\n//                         indicator: 'orange'\r\n//                     });\r\n//                     return;\r\n//                 }\r\n\r\n//                 let d = new frappe.ui.Dialog({\r\n//                     title: 'Select Company, Customer & Subcontracting Order',\r\n//                     fields: [\r\n//                         {\r\n//                             label: 'Select Company',\r\n//                             fieldname: 'selected_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             reqd: 1,\r\n//                             onchange: () => {\r\n//                                 d.set_value('customer', '');\r\n//                                 d.set_value('customer_company', '');\r\n//                                 d.set_value('subcontracting_order', '');\r\n                                \r\n//                                 d.fields_dict.customer.get_query = () => {\r\n//                                     let selected_company = d.get_value('selected_company');\r\n//                                     return {\r\n//                                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                         filters: {\r\n//                                             company: selected_company\r\n//                                         }\r\n//                                     };\r\n//                                 };\r\n//                                 d.fields_dict.customer.refresh();\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Internal Customer',\r\n//                             fieldname: 'customer',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Customer',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let selected_company = d.get_value('selected_company');\r\n                                \r\n//                                 if (!selected_company) {\r\n//                                     frappe.msgprint(__('Please select a company first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                                     filters: {\r\n//                                         company: selected_company\r\n//                                     }\r\n//                                 };\r\n//                             },\r\n//                             onchange: () => {\r\n//                                 let customer = d.get_value('customer');\r\n                                \r\n//                                 if (customer) {\r\n//                                     frappe.call({\r\n//                                         method: \"frappe.client.get_value\",\r\n//                                         args: {\r\n//                                             doctype: \"Customer\",\r\n//                                             filters: { name: customer },\r\n//                                             fieldname: \"represents_company\"\r\n//                                         },\r\n//                                         callback(r) {\r\n//                                             if (r.message) {\r\n//                                                 d.set_value(\"customer_company\", r.message.represents_company);\r\n//                                             }\r\n//                                         }\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         },\r\n//                         {\r\n//                             label: 'Customer Company',\r\n//                             fieldname: 'customer_company',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Company',\r\n//                             read_only: 1\r\n//                         },\r\n//                         {\r\n//                             label: 'Subcontracting Order',\r\n//                             fieldname: 'subcontracting_order',\r\n//                             fieldtype: 'Link',\r\n//                             options: 'Subcontracting Order',\r\n//                             reqd: 1,\r\n//                             get_query: () => {\r\n//                                 let customer_company = d.get_value(\"customer_company\");\r\n                                \r\n//                                 if (!customer_company) {\r\n//                                     frappe.msgprint(__('Please select a customer first'));\r\n//                                     return { filters: { name: ['=', ''] } };\r\n//                                 }\r\n                                \r\n//                                 return {\r\n//                                     query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                     filters: {\r\n//                                         company: customer_company\r\n//                                     }\r\n//                                 };\r\n//                             }\r\n//                         }\r\n//                     ],\r\n                    \r\n//                     primary_action_label: 'Load Data',\r\n//                     primary_action(values) {\r\n                        \r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get\",\r\n//                             args: {\r\n//                                 doctype: \"Subcontracting Order\",\r\n//                                 name: values.subcontracting_order\r\n//                             },\r\n//                             callback(r) {\r\n//                                 let sco = r.message;\r\n\r\n//                                 frappe.call({\r\n//                                     method: \"frappe.client.get_value\",\r\n//                                     args: {\r\n//                                         doctype: \"Supplier\",\r\n//                                         filters: { name: sco.supplier },\r\n//                                         fieldname: \"represents_company\"\r\n//                                     },\r\n//                                     callback(res) {\r\n//                                         if (!res.message || !res.message.represents_company) {\r\n//                                             frappe.msgprint(__(\"Supplier company not found\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let supplier_company = res.message.represents_company;\r\n\r\n//                                         if (supplier_company !== values.selected_company) {\r\n//                                             frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         frm.set_value(\"company\", supplier_company);\r\n//                                         frm.set_value(\"customer\", values.customer);\r\n//                                         frm.set_value(\"po_no\", sco.name);\r\n//                                         frm.set_value(\"po_date\", sco.transaction_date);\r\n//                                         frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n//                                         console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n//                                             subcontracting_order: sco.name,\r\n//                                             purchase_order: sco.purchase_order,\r\n//                                             job_worker: sco.supplier,\r\n//                                             job_worker_name: sco.supplier_name,\r\n//                                             job_worker_warehouse: sco.supplier_warehouse,\r\n//                                             company: sco.company,\r\n//                                             schedule_date: sco.schedule_date,\r\n//                                             items: sco.items\r\n//                                         });\r\n\r\n//                                         frm.clear_table(\"items\");\r\n\r\n//                                         let items = sco.items || [];\r\n                                        \r\n//                                         if (items.length === 0) {\r\n//                                             frappe.show_alert({\r\n//                                                 message: __(\"No items found in Subcontracting Order\"),\r\n//                                                 indicator: 'orange'\r\n//                                             });\r\n//                                             frm.refresh_fields();\r\n//                                             return;\r\n//                                         }\r\n\r\n//                                         let processed = 0;\r\n\r\n//                                         items.forEach((item) => {\r\n//                                             frappe.call({\r\n//                                                 method: \"galaxynext.api.get_item_default_warehouse\",\r\n//                                                 args: {\r\n//                                                     item_code: item.item_code,\r\n//                                                     company: supplier_company\r\n//                                                 },\r\n//                                                 callback(wr) {\r\n//                                                     let warehouse = wr.message || item.warehouse;\r\n\r\n//                                                     let row = frm.add_child(\"items\");\r\n//                                                     row.item_code = item.item_code;\r\n//                                                     row.item_name = item.item_name;\r\n//                                                     row.qty = item.qty;\r\n//                                                     row.uom = item.uom || item.stock_uom;\r\n//                                                     row.delivery_date = sco.schedule_date;\r\n//                                                     row.warehouse = warehouse;\r\n//                                                     row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n\r\n//                                                     processed++;\r\n\r\n//                                                     if (processed === items.length) {\r\n//                                                         frm.refresh_field(\"company\");\r\n//                                                         frm.refresh_field(\"customer\");\r\n//                                                         frm.refresh_field(\"po_no\");\r\n//                                                         frm.refresh_field(\"po_date\");\r\n//                                                         frm.refresh_field(\"delivery_date\");\r\n//                                                         frm.refresh_field(\"items\");\r\n                                                        \r\n//                                                         frm._subcontracting_loaded = true;\r\n                                                        \r\n//                                                         frappe.show_alert({\r\n//                                                             message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n//                                                             indicator: 'green'\r\n//                                                         });\r\n\r\n//                                                         console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                                             company: frm.doc.company,\r\n//                                                             customer: frm.doc.customer,\r\n//                                                             po_no: frm.doc.po_no,\r\n//                                                             po_date: frm.doc.po_date,\r\n//                                                             delivery_date: frm.doc.delivery_date,\r\n//                                                             items_count: frm.doc.items.length,\r\n//                                                             items: frm.doc.items\r\n//                                                         });\r\n//                                                     }\r\n//                                                 }\r\n//                                             });\r\n//                                         });\r\n//                                     }\r\n//                                 });\r\n//                             }\r\n//                         });\r\n\r\n//                         d.hide();\r\n//                     }\r\n//                 });\r\n\r\n//                 d.show();\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n// ---------------------------------------future code-server implement not done---------------------------------------\r\n\r\n\r\n\r\n\r\n\r\n\r\n// frappe.ui.form.on('Sales Order', {\r\n//     refresh(frm) {\r\n//         // ============================================\r\n//         // FEATURE 1: Make PO Number clickable to open Subcontracting Order\r\n//         // ============================================\r\n//         if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n//             frm.fields_dict['po_no'].$wrapper.find('input').css({\r\n//                 'cursor': 'pointer',\r\n//                 'color': '#007bff',\r\n//                 'text-decoration': 'underline'\r\n//             });\r\n            \r\n//             frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n//                 frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n//             });\r\n//         }\r\n\r\n//         // ============================================\r\n//         // FEATURE 2: Load From Subcontracting Button\r\n//         // ============================================\r\n//         if (frm.doc.docstatus === 0) {\r\n//             // Remove existing button to prevent duplicates\r\n//             frm.remove_custom_button('Load From Subcontracting');\r\n            \r\n//             frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n//                 // âœ… Check if data already loaded in this session\r\n//                 if (frm._subcontracting_loaded) {\r\n//                     frappe.msgprint({\r\n//                         title: __('Already Loaded'),\r\n//                         message: __('Data has already been loaded from Subcontracting Order.<br>Please <b>refresh</b> or <b>reload</b> the page to load again.'),\r\n//                         indicator: 'orange'\r\n//                     });\r\n//                     return;\r\n//                 }\r\n                \r\n//                 // âœ… Direct load - No confirmation needed\r\n//                 show_subcontracting_dialog(frm);\r\n//             });\r\n//         }\r\n//     }\r\n// });\r\n\r\n// // ============================================\r\n// // Main Dialog Function\r\n// // ============================================\r\n// function show_subcontracting_dialog(frm) {\r\n//     let d = new frappe.ui.Dialog({\r\n//         title: 'Select Company, Customer & Subcontracting Order',\r\n//         fields: [\r\n//             {\r\n//                 label: 'Select Company',\r\n//                 fieldname: 'selected_company',\r\n//                 fieldtype: 'Link',\r\n//                 options: 'Company',\r\n//                 reqd: 1,\r\n//                 onchange: () => {\r\n//                     // Clear dependent fields\r\n//                     d.set_value('customer', '');\r\n//                     d.set_value('customer_company', '');\r\n//                     d.set_value('subcontracting_order', '');\r\n                    \r\n//                     // Refresh customer field query\r\n//                     let selected_company = d.get_value('selected_company');\r\n//                     if (selected_company) {\r\n//                         d.fields_dict.customer.get_query = () => ({\r\n//                             query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                             filters: { company: selected_company }\r\n//                         });\r\n//                         d.fields_dict.customer.refresh();\r\n//                     }\r\n//                 }\r\n//             },\r\n//             {\r\n//                 label: 'Internal Customer',\r\n//                 fieldname: 'customer',\r\n//                 fieldtype: 'Link',\r\n//                 options: 'Customer',\r\n//                 reqd: 1,\r\n//                 get_query: () => {\r\n//                     let selected_company = d.get_value('selected_company');\r\n                    \r\n//                     if (!selected_company) {\r\n//                         frappe.msgprint({\r\n//                             title: __('Company Required'),\r\n//                             message: __('Please select a company first'),\r\n//                             indicator: 'orange'\r\n//                         });\r\n//                         return { filters: { name: ['=', ''] } };\r\n//                     }\r\n                    \r\n//                     return {\r\n//                         query: \"galaxynext.api.get_allowed_internal_customers\",\r\n//                         filters: { company: selected_company }\r\n//                     };\r\n//                 },\r\n//                 onchange: () => {\r\n//                     let customer = d.get_value('customer');\r\n                    \r\n//                     if (customer) {\r\n//                         // Clear subcontracting order when customer changes\r\n//                         d.set_value('subcontracting_order', '');\r\n                        \r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get_value\",\r\n//                             args: {\r\n//                                 doctype: \"Customer\",\r\n//                                 filters: { name: customer },\r\n//                                 fieldname: \"represents_company\"\r\n//                             },\r\n//                             callback(r) {\r\n//                                 if (r.message && r.message.represents_company) {\r\n//                                     d.set_value(\"customer_company\", r.message.represents_company);\r\n                                    \r\n//                                     // Refresh subcontracting order field\r\n//                                     d.fields_dict.subcontracting_order.get_query = () => ({\r\n//                                         query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                                         filters: { company: r.message.represents_company }\r\n//                                     });\r\n//                                     d.fields_dict.subcontracting_order.refresh();\r\n//                                 } else {\r\n//                                     frappe.msgprint({\r\n//                                         title: __('Error'),\r\n//                                         message: __('Customer company not found'),\r\n//                                         indicator: 'red'\r\n//                                     });\r\n//                                 }\r\n//                             },\r\n//                             error(err) {\r\n//                                 console.error(\"Error fetching customer company:\", err);\r\n//                                 frappe.msgprint({\r\n//                                     title: __('Error'),\r\n//                                     message: __('Failed to fetch customer company'),\r\n//                                     indicator: 'red'\r\n//                                 });\r\n//                             }\r\n//                         });\r\n//                     }\r\n//                 }\r\n//             },\r\n//             {\r\n//                 label: 'Customer Company',\r\n//                 fieldname: 'customer_company',\r\n//                 fieldtype: 'Link',\r\n//                 options: 'Company',\r\n//                 read_only: 1\r\n//             },\r\n//             {\r\n//                 label: 'Subcontracting Order',\r\n//                 fieldname: 'subcontracting_order',\r\n//                 fieldtype: 'Link',\r\n//                 options: 'Subcontracting Order',\r\n//                 reqd: 1,\r\n//                 get_query: () => {\r\n//                     let customer_company = d.get_value(\"customer_company\");\r\n                    \r\n//                     if (!customer_company) {\r\n//                         frappe.msgprint({\r\n//                             title: __('Customer Required'),\r\n//                             message: __('Please select a customer first'),\r\n//                             indicator: 'orange'\r\n//                         });\r\n//                         return { filters: { name: ['=', ''] } };\r\n//                     }\r\n                    \r\n//                     return {\r\n//                         query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n//                         filters: { company: customer_company }\r\n//                     };\r\n//                 },\r\n//                 onchange: () => {\r\n//                     // Optional: Validate if SC Order is already used\r\n//                     let sc_order = d.get_value('subcontracting_order');\r\n//                     if (sc_order) {\r\n//                         frappe.call({\r\n//                             method: \"galaxynext.api.validate_subcontracting_order_usage\",\r\n//                             args: { subcontracting_order: sc_order },\r\n//                             callback(r) {\r\n//                                 if (r.message && r.message.is_used) {\r\n//                                     frappe.msgprint({\r\n//                                         title: __('Warning'),\r\n//                                         message: r.message.message,\r\n//                                         indicator: 'orange'\r\n//                                     });\r\n//                                 }\r\n//                             }\r\n//                         });\r\n//                     }\r\n//                 }\r\n//             }\r\n//         ],\r\n        \r\n//         primary_action_label: 'Load Data',\r\n//         primary_action(values) {\r\n//             load_subcontracting_data(frm, values, d);\r\n//         }\r\n//     });\r\n\r\n//     d.show();\r\n// }\r\n\r\n// // ============================================\r\n// // Data Loading Function with Batch API\r\n// // ============================================\r\n// function load_subcontracting_data(frm, values, dialog) {\r\n//     // Show loading indicator\r\n//     frappe.show_alert({\r\n//         message: __('Loading Subcontracting Order data...'),\r\n//         indicator: 'blue'\r\n//     }, 3);\r\n\r\n//     frappe.call({\r\n//         method: \"frappe.client.get\",\r\n//         args: {\r\n//             doctype: \"Subcontracting Order\",\r\n//             name: values.subcontracting_order\r\n//         },\r\n//         callback(r) {\r\n//             if (!r.message) {\r\n//                 frappe.msgprint({\r\n//                     title: __('Error'),\r\n//                     message: __('Subcontracting Order not found'),\r\n//                     indicator: 'red'\r\n//                 });\r\n//                 return;\r\n//             }\r\n            \r\n//             let sco = r.message;\r\n\r\n//             // Fetch supplier company\r\n//             frappe.call({\r\n//                 method: \"frappe.client.get_value\",\r\n//                 args: {\r\n//                     doctype: \"Supplier\",\r\n//                     filters: { name: sco.supplier },\r\n//                     fieldname: \"represents_company\"\r\n//                 },\r\n//                 callback(res) {\r\n//                     if (!res.message || !res.message.represents_company) {\r\n//                         frappe.msgprint({\r\n//                             title: __('Error'),\r\n//                             message: __(\"Supplier company not found for supplier: {0}\", [sco.supplier]),\r\n//                             indicator: 'red'\r\n//                         });\r\n//                         return;\r\n//                     }\r\n\r\n//                     let supplier_company = res.message.represents_company;\r\n\r\n//                     // Validate company match\r\n//                     if (supplier_company !== values.selected_company) {\r\n//                         frappe.msgprint({\r\n//                             title: __('Company Mismatch'),\r\n//                             message: __(\"Selected company ({0}) does not match the supplier company ({1})\", \r\n//                                 [values.selected_company, supplier_company]),\r\n//                             indicator: 'red'\r\n//                         });\r\n//                         return;\r\n//                     }\r\n\r\n//                     // Validate items exist\r\n//                     let items = sco.items || [];\r\n//                     if (items.length === 0) {\r\n//                         frappe.msgprint({\r\n//                             title: __('No Items'),\r\n//                             message: __(\"No items found in Subcontracting Order: {0}\", [sco.name]),\r\n//                             indicator: 'orange'\r\n//                         });\r\n//                         return;\r\n//                     }\r\n\r\n//                     // Set header fields\r\n//                     frm.set_value(\"company\", supplier_company);\r\n//                     frm.set_value(\"customer\", values.customer);\r\n//                     frm.set_value(\"po_no\", sco.name);\r\n//                     frm.set_value(\"po_date\", sco.transaction_date);\r\n//                     frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                    \r\n//                     console.log(\"ðŸ“¦ Subcontracting Order Data:\", {\r\n//                         subcontracting_order: sco.name,\r\n//                         purchase_order: sco.purchase_order,\r\n//                         job_worker: sco.supplier,\r\n//                         company: sco.company,\r\n//                         schedule_date: sco.schedule_date,\r\n//                         items_count: items.length\r\n//                     });\r\n\r\n//                     // Clear existing items\r\n//                     frm.clear_table(\"items\");\r\n\r\n//                     // âœ… BATCH API: Fetch all warehouses in ONE call\r\n//                     let item_codes = items.map(item => item.item_code);\r\n                    \r\n//                     frappe.call({\r\n//                         method: \"galaxynext.api.get_multiple_item_warehouses\",\r\n//                         args: {\r\n//                             item_codes: item_codes,\r\n//                             company: supplier_company\r\n//                         },\r\n//                         callback(wr) {\r\n//                             let warehouse_map = wr.message || {};\r\n                            \r\n//                             console.log(\"ðŸ­ Warehouse Map:\", warehouse_map);\r\n                            \r\n//                             // Add all items at once\r\n//                             items.forEach((item) => {\r\n//                                 let row = frm.add_child(\"items\");\r\n//                                 row.item_code = item.item_code;\r\n//                                 row.item_name = item.item_name;\r\n//                                 row.description = item.description || item.item_name;\r\n//                                 row.qty = item.qty;\r\n//                                 row.uom = item.uom || item.stock_uom;\r\n//                                 row.delivery_date = sco.schedule_date;\r\n                                \r\n//                                 // Get warehouse from batch result\r\n//                                 row.warehouse = warehouse_map[item.item_code] || item.warehouse || '';\r\n                                \r\n//                                 // Set rate properly (not amount)\r\n//                                 row.rate = item.rate || 0;\r\n                                \r\n//                                 // Optional: Copy additional fields\r\n//                                 if (item.bom) row.bom_no = item.bom;\r\n//                                 if (item.brand) row.brand = item.brand;\r\n//                                 if (item.item_group) row.item_group = item.item_group;\r\n//                             });\r\n\r\n//                             // Refresh all fields at once\r\n//                             frm.refresh_field(\"company\");\r\n//                             frm.refresh_field(\"customer\");\r\n//                             frm.refresh_field(\"po_no\");\r\n//                             frm.refresh_field(\"po_date\");\r\n//                             frm.refresh_field(\"delivery_date\");\r\n//                             frm.refresh_field(\"items\");\r\n                            \r\n//                             // âœ… Mark as loaded - prevents reloading until refresh\r\n//                             frm._subcontracting_loaded = true;\r\n                            \r\n//                             // Success message\r\n//                             frappe.show_alert({\r\n//                                 message: __(\"âœ“ {0} items loaded successfully from {1}\", [items.length, sco.name]),\r\n//                                 indicator: 'green'\r\n//                             }, 5);\r\n\r\n//                             console.log(\"âœ… Sales Order Data Loaded:\", {\r\n//                                 company: frm.doc.company,\r\n//                                 customer: frm.doc.customer,\r\n//                                 po_no: frm.doc.po_no,\r\n//                                 items_count: frm.doc.items.length,\r\n//                                 total_qty: frm.doc.items.reduce((sum, i) => sum + (i.qty || 0), 0),\r\n//                                 reload_required_for_next_load: true\r\n//                             });\r\n                            \r\n//                             dialog.hide();\r\n//                         },\r\n//                         error(err) {\r\n//                             console.error(\"âŒ Batch warehouse fetch error:\", err);\r\n                            \r\n//                             // Fallback: Load items without warehouse optimization\r\n//                             frappe.msgprint({\r\n//                                 title: __('Warehouse Fetch Failed'),\r\n//                                 message: __('Loading items with default warehouses. You may need to update warehouses manually.'),\r\n//                                 indicator: 'orange'\r\n//                             });\r\n                            \r\n//                             items.forEach((item) => {\r\n//                                 let row = frm.add_child(\"items\");\r\n//                                 row.item_code = item.item_code;\r\n//                                 row.item_name = item.item_name;\r\n//                                 row.description = item.description || item.item_name;\r\n//                                 row.qty = item.qty;\r\n//                                 row.uom = item.uom || item.stock_uom;\r\n//                                 row.delivery_date = sco.schedule_date;\r\n//                                 row.warehouse = item.warehouse || '';\r\n//                                 row.rate = item.rate || 0;\r\n                                \r\n//                                 if (item.bom) row.bom_no = item.bom;\r\n//                             });\r\n                            \r\n//                             frm.refresh_field(\"items\");\r\n                            \r\n//                             // âœ… Mark as loaded even in fallback case\r\n//                             frm._subcontracting_loaded = true;\r\n                            \r\n//                             frappe.show_alert({\r\n//                                 message: __(\"{0} items loaded (warehouses may need manual update)\", [items.length]),\r\n//                                 indicator: 'orange'\r\n//                             }, 5);\r\n                            \r\n//                             dialog.hide();\r\n//                         }\r\n//                     });\r\n//                 },\r\n//                 error(err) {\r\n//                     console.error(\"âŒ Supplier company fetch error:\", err);\r\n//                     frappe.msgprint({\r\n//                         title: __('Error'),\r\n//                         message: __('Failed to fetch supplier company details'),\r\n//                         indicator: 'red'\r\n//                     });\r\n//                 }\r\n//             });\r\n//         },\r\n//         error(err) {\r\n//             console.error(\"âŒ Subcontracting Order fetch error:\", err);\r\n//             frappe.msgprint({\r\n//                 title: __('Error'),\r\n//                 message: __('Failed to fetch Subcontracting Order: {0}', [err.message || 'Unknown error']),\r\n//                 indicator: 'red'\r\n//             });\r\n//         }\r\n//     });\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfrappe.ui.form.on('Sales Order', {\r\n    refresh(frm) {\r\n        // ============================================\r\n        // FEATURE 1: Make PO Number clickable to open Subcontracting Order\r\n        // ============================================\r\n        if (frm.doc.po_no && frm.doc.po_no.startsWith('SC-ORD-')) {\r\n            frm.fields_dict['po_no'].$wrapper.find('input').css('cursor', 'pointer');\r\n            \r\n            frm.fields_dict['po_no'].$wrapper.off('click').on('click', function() {\r\n                frappe.set_route('Form', 'Subcontracting Order', frm.doc.po_no);\r\n            });\r\n        }\r\n\r\n        // ============================================\r\n        // FEATURE 2: Load From Subcontracting Button\r\n        // ============================================\r\n        if (frm.doc.docstatus === 0 && frm.is_new()) {\r\n            frm.add_custom_button(__('Load From Subcontracting'), function() {\r\n                \r\n                if (frm._subcontracting_loaded) {\r\n                    frappe.msgprint({\r\n                        title: __('Already Loaded'),\r\n                        message: __('Data has already been loaded from Subcontracting Order. Please refresh the page to load again.'),\r\n                        indicator: 'orange'\r\n                    });\r\n                    return;\r\n                }\r\n\r\n                let d = new frappe.ui.Dialog({\r\n                    title: 'Select Company, Customer & Subcontracting Order',\r\n                    fields: [\r\n                        {\r\n                            label: 'Select Company',\r\n                            fieldname: 'selected_company',\r\n                            fieldtype: 'Link',\r\n                            options: 'Company',\r\n                            reqd: 1,\r\n                            onchange: () => {\r\n                                d.set_value('customer', '');\r\n                                d.set_value('customer_company', '');\r\n                                d.set_value('subcontracting_order', '');\r\n                                \r\n                                d.fields_dict.customer.get_query = () => {\r\n                                    let selected_company = d.get_value('selected_company');\r\n                                    return {\r\n                                        query: \"galaxynext.api.get_allowed_internal_customers\",\r\n                                        filters: {\r\n                                            company: selected_company\r\n                                        }\r\n                                    };\r\n                                };\r\n                                d.fields_dict.customer.refresh();\r\n                            }\r\n                        },\r\n                        {\r\n                            label: 'Internal Customer',\r\n                            fieldname: 'customer',\r\n                            fieldtype: 'Link',\r\n                            options: 'Customer',\r\n                            reqd: 1,\r\n                            get_query: () => {\r\n                                let selected_company = d.get_value('selected_company');\r\n                                \r\n                                if (!selected_company) {\r\n                                    frappe.msgprint(__('Please select a company first'));\r\n                                    return { filters: { name: ['=', ''] } };\r\n                                }\r\n                                \r\n                                return {\r\n                                    query: \"galaxynext.api.get_allowed_internal_customers\",\r\n                                    filters: {\r\n                                        company: selected_company\r\n                                    }\r\n                                };\r\n                            },\r\n                            onchange: () => {\r\n                                let customer = d.get_value('customer');\r\n                                \r\n                                if (customer) {\r\n                                    frappe.call({\r\n                                        method: \"frappe.client.get_value\",\r\n                                        args: {\r\n                                            doctype: \"Customer\",\r\n                                            filters: { name: customer },\r\n                                            fieldname: \"represents_company\"\r\n                                        },\r\n                                        callback(r) {\r\n                                            if (r.message) {\r\n                                                d.set_value(\"customer_company\", r.message.represents_company);\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        },\r\n                        {\r\n                            label: 'Customer Company',\r\n                            fieldname: 'customer_company',\r\n                            fieldtype: 'Link',\r\n                            options: 'Company',\r\n                            read_only: 1\r\n                        },\r\n                        {\r\n                            label: 'Subcontracting Order',\r\n                            fieldname: 'subcontracting_order',\r\n                            fieldtype: 'Link',\r\n                            options: 'Subcontracting Order',\r\n                            reqd: 1,\r\n                            get_query: () => {\r\n                                let customer_company = d.get_value(\"customer_company\");\r\n                                \r\n                                if (!customer_company) {\r\n                                    frappe.msgprint(__('Please select a customer first'));\r\n                                    return { filters: { name: ['=', ''] } };\r\n                                }\r\n                                \r\n                                return {\r\n                                    query: \"galaxynext.api.get_available_subcontracting_orders\",\r\n                                    filters: {\r\n                                        company: customer_company\r\n                                    }\r\n                                };\r\n                            }\r\n                        }\r\n                    ],\r\n                    \r\n                    primary_action_label: 'Load Data',\r\n                    primary_action(values) {\r\n                        \r\n                        frappe.call({\r\n                            method: \"frappe.client.get\",\r\n                            args: {\r\n                                doctype: \"Subcontracting Order\",\r\n                                name: values.subcontracting_order\r\n                            },\r\n                            callback(r) {\r\n                                let sco = r.message;\r\n\r\n                                frappe.call({\r\n                                    method: \"frappe.client.get_value\",\r\n                                    args: {\r\n                                        doctype: \"Supplier\",\r\n                                        filters: { name: sco.supplier },\r\n                                        fieldname: \"represents_company\"\r\n                                    },\r\n                                    callback(res) {\r\n                                        if (!res.message || !res.message.represents_company) {\r\n                                            frappe.msgprint(__(\"Supplier company not found\"));\r\n                                            return;\r\n                                        }\r\n\r\n                                        let supplier_company = res.message.represents_company;\r\n\r\n                                        if (supplier_company !== values.selected_company) {\r\n                                            frappe.msgprint(__(\"Selected company does not match the supplier company\"));\r\n                                            return;\r\n                                        }\r\n\r\n                                        frm.set_value(\"company\", supplier_company);\r\n                                        frm.set_value(\"customer\", values.customer);\r\n                                        frm.set_value(\"po_no\", sco.name);\r\n                                        frm.set_value(\"po_date\", sco.transaction_date);\r\n                                        frm.set_value(\"delivery_date\", sco.schedule_date);\r\n                                        \r\n                                        console.log(\"ðŸ“¦ Subcontracting Order Full Data:\", {\r\n                                            subcontracting_order: sco.name,\r\n                                            purchase_order: sco.purchase_order,\r\n                                            job_worker: sco.supplier,\r\n                                            job_worker_name: sco.supplier_name,\r\n                                            job_worker_warehouse: sco.supplier_warehouse,\r\n                                            company: sco.company,\r\n                                            schedule_date: sco.schedule_date,\r\n                                            items: sco.items\r\n                                        });\r\n\r\n                                        frm.clear_table(\"items\");\r\n\r\n                                        let items = sco.items || [];\r\n                                        \r\n                                        if (items.length === 0) {\r\n                                            frappe.show_alert({\r\n                                                message: __(\"No items found in Subcontracting Order\"),\r\n                                                indicator: 'orange'\r\n                                            });\r\n                                            frm.refresh_fields();\r\n                                            return;\r\n                                        }\r\n\r\n                                        let processed = 0;\r\n\r\n                                        items.forEach((item) => {\r\n                                            // First get warehouse\r\n                                            frappe.call({\r\n                                                method: \"galaxynext.api.get_item_default_warehouse\",\r\n                                                args: {\r\n                                                    item_code: item.item_code,\r\n                                                    company: supplier_company\r\n                                                },\r\n                                                callback(wr) {\r\n                                                    let warehouse = wr.message || item.warehouse;\r\n\r\n                                                    // Then get BOM for the item\r\n                                                    frappe.call({\r\n                                                        method: \"frappe.client.get_value\",\r\n                                                        args: {\r\n                                                            doctype: \"Item\",\r\n                                                            filters: { name: item.item_code },\r\n                                                            fieldname: [\"default_bom\"]\r\n                                                        },\r\n                                                        callback(bom_res) {\r\n                                                            let bom_no = bom_res.message ? bom_res.message.default_bom : \"\";\r\n\r\n                                                            // àª¬àª§à«€ àªœ items add àª•àª°à«‹\r\n                                                            let row = frm.add_child(\"items\");\r\n                                                            row.item_code = item.item_code;\r\n                                                            row.item_name = item.item_name;\r\n                                                            row.qty = item.qty;\r\n                                                            row.uom = item.uom || item.stock_uom;\r\n                                                            row.delivery_date = sco.schedule_date;\r\n                                                            row.warehouse = warehouse;\r\n                                                            row.rate = item.rate || item.amount || item.valuation_rate || 0;\r\n                                                            \r\n                                                            // àªœà«‹ BOM àª¹à«‹àª¯ àª¤à«‹ set àª•àª°à«‹, àª¨àª¹à«€àª‚ àª¤à«‹ blank àª°àª¹à«‡àª¶à«‡\r\n                                                            if (bom_no) {\r\n                                                                row.bom_no = bom_no;\r\n                                                            }\r\n\r\n                                                            processed++;\r\n\r\n                                                            if (processed === items.length) {\r\n                                                                frm.refresh_field(\"company\");\r\n                                                                frm.refresh_field(\"customer\");\r\n                                                                frm.refresh_field(\"po_no\");\r\n                                                                frm.refresh_field(\"po_date\");\r\n                                                                frm.refresh_field(\"delivery_date\");\r\n                                                                frm.refresh_field(\"items\");\r\n                                                                \r\n                                                                frm._subcontracting_loaded = true;\r\n                                                                \r\n                                                                frappe.show_alert({\r\n                                                                    message: __(\"{0} items loaded successfully from {1}\", [processed, sco.name]),\r\n                                                                    indicator: 'green'\r\n                                                                });\r\n\r\n                                                                console.log(\"âœ… Sales Order Data Loaded:\", {\r\n                                                                    company: frm.doc.company,\r\n                                                                    customer: frm.doc.customer,\r\n                                                                    po_no: frm.doc.po_no,\r\n                                                                    po_date: frm.doc.po_date,\r\n                                                                    delivery_date: frm.doc.delivery_date,\r\n                                                                    items_count: frm.doc.items.length,\r\n                                                                    items: frm.doc.items\r\n                                                                });\r\n                                                            }\r\n                                                        }\r\n                                                    });\r\n                                                }\r\n                                            });\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n\r\n                        d.hide();\r\n                    }\r\n                });\r\n\r\n                d.show();\r\n            });\r\n        }\r\n    },\r\n\r\n    // ============================================\r\n    // FEATURE 3: Auto-sync Delivery Date to all items\r\n    // ============================================\r\n    delivery_date: function(frm) {\r\n        if (frm.doc.delivery_date && frm.doc.items && frm.doc.items.length > 0) {\r\n            let updated_count = 0;\r\n            \r\n            frm.doc.items.forEach(function(item) {\r\n                if (item.delivery_date !== frm.doc.delivery_date) {\r\n                    frappe.model.set_value(item.doctype, item.name, 'delivery_date', frm.doc.delivery_date);\r\n                    updated_count++;\r\n                }\r\n            });\r\n\r\n            if (updated_count > 0) {\r\n                frm.refresh_field('items');\r\n                frappe.show_alert({\r\n                    message: __('Delivery date updated for {0} items', [updated_count]),\r\n                    indicator: 'blue'\r\n                });\r\n            }\r\n        }\r\n    }\r\n});",
  "view": "Form"
 }
]