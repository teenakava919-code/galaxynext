[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 1,
  "modified": "2025-08-23 12:02:04.981672",
  "module": null,
  "name": "customer testing script",
  "script": " frappe.ui.form.on('Customer', {\r\n    test_value_1: function(frm) {\r\n        // àªœàª¯àª¾àª°à«‡ Test Value 1 change àª¥àª¾àª¯\r\n        frappe.show_alert({\r\n            message: __('You typed: {0}', [frm.doc.test_value_1]),\r\n            indicator: 'blue'\r\n        }, 5);\r\n    },\r\n\r\n    test_value_2: function(frm) {\r\n        // Test Value 2 change àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ Test Value 1 auto update\r\n        if (frm.doc.test_value_2) {\r\n            frm.set_value('test_value_1', frm.doc.test_value_2.toUpperCase());\r\n            frappe.msgprint(__('Test Value 1 auto-filled with UPPERCASE of Test Value 2'));\r\n        }\r\n    }\r\n});\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Supplier",
  "enabled": 1,
  "modified": "2025-08-23 13:02:09.588259",
  "module": null,
  "name": "supplier testing script",
  "script": "frappe.ui.form.on('Supplier', {\r\n    test_value_1: function(frm) {\r\n        // àªœàª¯àª¾àª°à«‡ Test Value 1 change àª¥àª¾àª¯\r\n        frappe.show_alert({\r\n            message: __('You typed: {0}', [frm.doc.test_value_1]),\r\n            indicator: 'blue'\r\n        }, 5);\r\n    },\r\n\r\n    test_value_2: function(frm) {\r\n        // Test Value 2 change àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ Test Value 1 auto update\r\n        if (frm.doc.test_value_2) {\r\n            frm.set_value('test_value_1', frm.doc.test_value_2.toUpperCase());\r\n            frappe.msgprint(__('Test Value 1 auto-filled with UPPERCASE of Test Value 2'));\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Card",
  "enabled": 1,
  "modified": "2025-08-23 15:22:38.120540",
  "module": null,
  "name": "jab card testing client script",
  "script": "frappe.ui.form.on('Job Card', {\r\n    test_value_1: function(frm) {\r\n        // àªœàª¯àª¾àª°à«‡ Test Value 1 change àª¥àª¾àª¯\r\n        frappe.show_alert({\r\n            message: __('You typed: {0}', [frm.doc.test_value_1]),\r\n            indicator: 'blue'\r\n        }, 5);\r\n    },\r\n\r\n    test_value_2: function(frm) {\r\n        // Test Value 2 change àª¥àª¾àª¯ àª¤à«àª¯àª¾àª°à«‡ Test Value 1 auto update\r\n        if (frm.doc.test_value_2) {\r\n            frm.set_value('test_value_1', frm.doc.test_value_2.toUpperCase());\r\n            frappe.msgprint(__('Test Value 1 auto-filled with UPPERCASE of Test Value 2'));\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Work Order",
  "enabled": 1,
  "modified": "2025-08-25 11:05:45.100020",
  "module": null,
  "name": "work order client script",
  "script": "frappe.ui.form.on('Work Order', {\r\n    refresh(frm) {\r\n        // Add a label highlight effect\r\n        frm.fields_dict.client_name.$wrapper.css({\r\n            'background-color': '#e0ffe0',\r\n            'font-weight': 'bold'\r\n        });\r\n\r\n        // Automatically set a field if empty\r\n        if (!frm.doc.client_name) {\r\n            frm.set_value('client_name', 'Auto-filled by script');\r\n            frappe.show_alert({ \r\n                message: __('Client Name auto-filled'), \r\n                indicator: 'green' \r\n            });\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-08-22 12:21:57.376979",
  "module": null,
  "name": "project script",
  "script": "frappe.ui.form.on('Project', {\r\n    refresh(frm) {\r\n        // Add a label highlight effect\r\n        frm.fields_dict.client_name.$wrapper.css({\r\n            'background-color': '#e0ffe0',\r\n            'font-weight': 'bold'\r\n        });\r\n\r\n        // Automatically set a field if empty\r\n        if (!frm.doc.client_name) {\r\n            frm.set_value('client_name', 'Auto-filled by script');\r\n            frappe.show_alert({ \r\n                message: __('Client Name auto-filled'), \r\n                indicator: 'green' \r\n            });\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Campaign",
  "enabled": 1,
  "modified": "2025-08-25 15:08:52.904598",
  "module": "galaxynext",
  "name": "campaign client script",
  "script": "frappe.ui.form.on(\"Campaign\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Prospect",
  "enabled": 1,
  "modified": "2025-08-26 15:04:54.971402",
  "module": null,
  "name": "prospect client script",
  "script": "frappe.ui.form.on(\"Prospect\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Opportunity",
  "enabled": 1,
  "modified": "2025-08-25 16:26:07.133879",
  "module": null,
  "name": "opportunity client script",
  "script": "frappe.ui.form.on(\"Opportunity\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-08-26 15:03:09.029573",
  "module": null,
  "name": "lead client script",
  "script": "frappe.ui.form.on(\"Lead\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Contract",
  "enabled": 1,
  "modified": "2025-08-25 16:43:11.309979",
  "module": null,
  "name": "contract client script",
  "script": "frappe.ui.form.on(\"Contract\", {\r\n    refresh(frm) {\r\n        // Page refresh àª¥àª¤àª¾àª¨à«€ àª¸àª¾àª¥à«‡ message àª¬àª¤àª¾àªµàª¶à«‡\r\n        frappe.msgprint(\"Contact form loaded successfully!\");\r\n    },\r\n\r\n    test_checkbox(frm) {\r\n        if (frm.doc.test_checkbox) {\r\n            frappe.msgprint(\"âœ… Checkbox selected!\");\r\n        } else {\r\n            frappe.msgprint(\"âŒ Checkbox unselected!\");\r\n        }\r\n    },\r\n\r\n    test_remarks(frm) {\r\n        if (frm.doc.test_remarks) {\r\n            frappe.show_alert({\r\n                message: __(\"You entered: \" + frm.doc.test_remarks),\r\n                indicator: \"green\"\r\n            }, 5);\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "GERP_DOC",
  "enabled": 1,
  "modified": "2025-08-30 10:53:06.732001",
  "module": null,
  "name": "GERP client script",
  "script": "frappe.ui.form.on('GERP_DOC', {  // Replace with your Doctype\r\n    // Trigger when the form loads\r\n    onload: function(frm) {\r\n        // If title is empty, set default value\r\n        if (!frm.doc.title) {\r\n            frm.set_value('title', 'Default Title');\r\n        }\r\n\r\n        // Show message with current title\r\n        frappe.msgprint(`Current Title: ${frm.doc.title}`);\r\n        console.log(\"Form Loaded:\", frm.doc);\r\n    },\r\n\r\n    // Trigger when the 'title' field changes\r\n    title: function(frm) {\r\n        console.log(\"Title changed to:\", frm.doc.title);\r\n        frappe.msgprint(`You updated the Title to: ${frm.doc.title}`);\r\n    },\r\n\r\n    // Trigger before saving the form\r\n    before_save: function(frm) {\r\n        // Ensure title is not empty\r\n        if (!frm.doc.title) {\r\n            frm.set_value('title', 'Default Title');\r\n            frappe.msgprint(\"Title was empty, default value applied!\");\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "BOM",
  "enabled": 1,
  "modified": "2025-10-06 17:41:28.057974",
  "module": "galaxynext",
  "name": "fetch item parameter",
  "script": "// // frappe.ui.form.on(\"BOM\", {\r\n// //     item: function(frm) {\r\n// //         if (frm.doc.item) {\r\n// //             frappe.call({\r\n// //                 method: \"frappe.client.get\",\r\n// //                 args: {\r\n// //                     doctype: \"Item\",\r\n// //                     name: frm.doc.item\r\n// //                 },\r\n// //                 callback: function(r) {\r\n// //                     if (r.message) {\r\n// //                         let item_doc = r.message;\r\n\r\n// //                         // clear existing value\r\n// //                         frm.set_value(\"item_parameter\", \"\");\r\n\r\n// //                         // fetch child table (custom_item_parameters)\r\n// //                         if (item_doc.custom_item_parameters && item_doc.custom_item_parameters.length > 0) {\r\n// //                             let values = item_doc.custom_item_parameters.map(row => row.value).join(\", \");\r\n// //                             frm.set_value(\"item_parameter\", values);\r\n// //                         }\r\n// //                     }\r\n// //                 }\r\n// //             });\r\n// //         } else {\r\n// //             frm.set_value(\"item_parameter\", \"\");\r\n// //         }\r\n// //     }\r\n// // });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // value show code\r\n\r\n\r\n\r\n\r\n\r\n// // frappe.ui.form.on(\"BOM\", {\r\n// //     item: function(frm) {\r\n// //         if (frm.doc.item) {\r\n// //             // Method 1: Try to get the displayed value using a custom server call\r\n// //             frappe.call({\r\n// //                 method: \"frappe.client.get\",\r\n// //                 args: {\r\n// //                     doctype: \"Item\",\r\n// //                     name: frm.doc.item\r\n// //                 },\r\n// //                 callback: function(r) {\r\n// //                     frm.set_value(\"item_parameter\", \"\");\r\n                    \r\n// //                     if (r.message && r.message.custom_item_parameters) {\r\n// //                         // Find Design parameter\r\n// //                         let design_parameter = r.message.custom_item_parameters.find(row => \r\n// //                             row.parameter && row.parameter.toLowerCase() === 'design'\r\n// //                         );\r\n                        \r\n// //                         if (design_parameter) {\r\n// //                             // Try to resolve the actual display value\r\n// //                             // If the value is a code (like MM-09-2025-00031), we need to resolve it\r\n// //                             resolve_parameter_display_value(design_parameter.value, function(display_value) {\r\n// //                                 frm.set_value(\"item_parameter\", `Design: ${display_value}`);\r\n// //                                 frappe.show_alert({\r\n// //                                     message: `Design parameter: ${display_value}`,\r\n// //                                     indicator: 'green'\r\n// //                                 });\r\n// //                             });\r\n// //                         } else {\r\n// //                             frappe.show_alert({\r\n// //                                 message: 'No Design parameter found',\r\n// //                                 indicator: 'orange'\r\n// //                             });\r\n// //                         }\r\n// //                     }\r\n// //                 }\r\n// //             });\r\n// //         } else {\r\n// //             frm.set_value(\"item_parameter\", \"\");\r\n// //         }\r\n// //     }\r\n// // });\r\n\r\n// // // Helper function to resolve parameter display value\r\n// // function resolve_parameter_display_value(value, callback) {\r\n// //     // If value looks like a code (MM-09-2025-00031), try to resolve it\r\n// //     if (value && value.match(/MM-\\d{2}-\\d{4}-\\d{5}/)) {\r\n// //         // This might be a reference to another doctype\r\n// //         // Try common doctypes that might contain this pattern\r\n        \r\n// //         // Method 1: Check if it's an Item code\r\n// //         frappe.call({\r\n// //             method: \"frappe.client.get_value\",\r\n// //             args: {\r\n// //                 doctype: \"Item\",\r\n// //                 filters: {\"name\": value},\r\n// //                 fieldname: \"item_name\"\r\n// //             },\r\n// //             callback: function(r) {\r\n// //                 if (r.message && r.message.item_name) {\r\n// //                     callback(r.message.item_name);\r\n// //                 } else {\r\n// //                     // Method 2: Check if there's a custom doctype or field mapping\r\n// //                     // For now, let's try to extract a readable part or use as-is\r\n                    \r\n// //                     // Try to get a more readable version\r\n// //                     let readable_value = value.split('-').pop(); // Get last part\r\n// //                     if (readable_value === '00031') {\r\n// //                         callback('fabric'); // Hardcoded mapping - you might need to adjust this\r\n// //                     } else {\r\n// //                         callback(value); // Use original value if no mapping found\r\n// //                     }\r\n// //                 }\r\n// //             }\r\n// //         });\r\n// //     } else {\r\n// //         // Value is already in display format\r\n// //         callback(value || 'N/A');\r\n// //     }\r\n// // }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// frappe.ui.form.on(\"BOM\", {\r\n//     item: function(frm) {\r\n//         if (!frm.doc.item) {\r\n//             frm.set_value(\"item_parameter\", \"\");\r\n//             return;\r\n//         }\r\n\r\n//         // Fetch Item with Parameters\r\n//         frappe.call({\r\n//             method: \"frappe.client.get\",\r\n//             args: {\r\n//                 doctype: \"Item\",\r\n//                 name: frm.doc.item\r\n//             },\r\n//             callback: function(r) {\r\n//                 if (!r.message) return;\r\n\r\n//                 let item = r.message;\r\n//                 let design_value = \"\";\r\n\r\n//                 // Find Design parameter from Item â†’ Item Parameters\r\n//                 if (item.custom_item_parameters && item.custom_item_parameters.length > 0) {\r\n//                     let design_param = item.custom_item_parameters.find(d =>\r\n//                         d.parameter && d.parameter.toLowerCase() === \"design import\"\r\n//                     );\r\n\r\n//                     if (design_param) {\r\n//                         // Resolve link value (MiscellaneousMst) â†’ human readable\r\n//                         frappe.call({\r\n//                             method: \"frappe.client.get_value\",\r\n//                             args: {\r\n//                                 doctype: \"MiscellaneousMst\",\r\n//                                 filters: { name: design_param.value },\r\n//                                 fieldname: \"value\"\r\n//                             },\r\n//                             callback: function(res) {\r\n//                                 if (res.message && res.message.value) {\r\n//                                     design_value = res.message.value;\r\n//                                 } else {\r\n//                                     design_value = design_param.value;\r\n//                                 }\r\n\r\n//                                 frm.set_value(\"item_parameter\", design_value);\r\n//                                 frappe.show_alert({\r\n//                                     message: `Design import: ${design_value}`,\r\n//                                     indicator: \"green\"\r\n//                                 });\r\n//                             }\r\n//                         });\r\n//                     } else {\r\n//                         frm.set_value(\"item_parameter\", \"\");\r\n//                         frappe.show_alert({\r\n//                             message: \"No Design parameter found\",\r\n//                             indicator: \"orange\"\r\n//                         });\r\n//                     }\r\n//                 }\r\n//             }\r\n//         });\r\n//     }\r\n// });\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// ----------------------------sujal working script \r\n\r\n\r\nfrappe.ui.form.on(\"BOM\", {\r\n    item: function(frm) {\r\n        if (!frm.doc.item) {\r\n            frm.set_value(\"item_parameter\", \"\");\r\n            return;\r\n        }\r\n        // Fetch Item with Parameters\r\n        frappe.call({\r\n            method: \"frappe.client.get\",\r\n            args: {\r\n                doctype: \"Item\",\r\n                name: frm.doc.item\r\n            },\r\n            callback: function(r) {\r\n                if (!r.message) return;\r\n                let item = r.message;\r\n                let design_value = \"\";\r\n                // Find Design parameter from Item â†’ Item Parameters\r\n                if (item.custom_item_parameters && item.custom_item_parameters.length > 0) {\r\n                    let design_param = item.custom_item_parameters.find(d =>\r\n                        d.parameter && d.parameter.toLowerCase() === \"design import\"\r\n                    );\r\n                    if (design_param) {\r\n                        // Resolve link value (MiscellaneousMst) â†’ human readable\r\n                        frappe.call({\r\n                            method: \"frappe.client.get_value\",\r\n                            args: {\r\n                                doctype: \"MiscellaneousMst\",\r\n                                filters: { name: design_param.value },\r\n                                fieldname: \"value\"\r\n                            },\r\n                            callback: function(res) {\r\n                                if (res.message && res.message.value) {\r\n                                    design_value = res.message.value;\r\n                                } else {\r\n                                    design_value = design_param.value;\r\n                                }\r\n                                frm.set_value(\"item_parameter\", design_value);\r\n                                frappe.show_alert({\r\n                                    message: `Design import: ${design_value}`,\r\n                                    indicator: \"green\"\r\n                                });\r\n                            }\r\n                        });\r\n                    } else {\r\n                        frm.set_value(\"item_parameter\", \"\");\r\n                        frappe.show_alert({\r\n                            message: \"No Design parameter found\",\r\n                            indicator: \"orange\"\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "BOM",
  "enabled": 1,
  "modified": "2025-09-22 16:53:48.677721",
  "module": "",
  "name": "Get Original Tab Table detail",
  "script": "// // perfect code\r\n// frappe.ui.form.on('BOM', {\r\n//     get_details: function(frm) {\r\n//         frappe.call({\r\n//             method: 'frappe.client.get_list',\r\n//             args: {\r\n//                 doctype: 'Design Import',\r\n//                 fields: ['name'],\r\n//                 order_by: 'creation desc',\r\n//                 limit_page_length: 1\r\n//             },\r\n//             callback: function(r) {\r\n//                 if (r.message && r.message.length) {\r\n//                     let latest_import = r.message[0].name;\r\n\r\n//                     frappe.call({\r\n//                         method: 'frappe.client.get',\r\n//                         args: {\r\n//                             doctype: 'Design Import',\r\n//                             name: latest_import\r\n//                         },\r\n//                         callback: function(res) {\r\n//                             if (res.message) {\r\n//                                 add_colors_to_bom(frm, res.message.original_tab_table || []);\r\n//                             } else {\r\n//                                 frappe.msgprint('âŒ No data found in latest Design Import.');\r\n//                             }\r\n//                         }\r\n//                     });\r\n\r\n//                 } else {\r\n//                     frappe.msgprint(\"âš ï¸ No Design Import records found.\");\r\n//                 }\r\n//             }\r\n//         });\r\n//     }\r\n// });\r\n\r\n// function add_colors_to_bom(frm, color_rows) {\r\n//     if (!color_rows.length) {\r\n//         frappe.msgprint(\"âš ï¸ No rows found in Original Tab Table.\");\r\n//         return;\r\n//     }\r\n\r\n//     frm.clear_table(\"items\");\r\n\r\n//     let added_count = 0;\r\n\r\n//     color_rows.forEach((row) => {\r\n//         if (row.color_name) {\r\n//             let child = frm.add_child(\"items\");\r\n//             child.item_code = row.color_name;\r\n//             child.qty = 1;\r\n//             child.uom = \"Nos\";\r\n//             child.rate = 0;\r\n\r\n//             // fetch stock info\r\n//             frappe.db.get_value(\"Item\", row.color_name, \"is_stock_item\", (r) => {\r\n//                 if (r && r.is_stock_item !== undefined) {\r\n//                     frappe.model.set_value(child.doctype, child.name, \"is_stock_item\", r.is_stock_item);\r\n//                 }\r\n//             });\r\n\r\n//             added_count++;\r\n//         }\r\n//     });\r\n\r\n//     frm.refresh_field(\"items\");\r\n\r\n//     frappe.msgprint(`âœ… ${added_count} Color Samples added from latest Design Import.`);\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // error\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// // frappe.ui.form.on('BOM', {\r\n// //     get_details: function(frm) {\r\n// //         frappe.call({\r\n// //             method: 'frappe.client.get_list',\r\n// //             args: {\r\n// //                 doctype: 'Design Import',\r\n// //                 fields: ['name'],\r\n// //                 order_by: 'creation desc',\r\n// //                 limit_page_length: 1\r\n// //             },\r\n// //             callback: function(r) {\r\n// //                 if (r.message && r.message.length) {\r\n// //                     let latest_import = r.message[0].name;\r\n// //                     frappe.call({\r\n// //                         method: 'frappe.client.get',\r\n// //                         args: {\r\n// //                             doctype: 'Design Import',\r\n// //                             name: latest_import\r\n// //                         },\r\n// //                         callback: function(res) {\r\n// //                             if (res.message) {\r\n// //                                 add_colors_to_bom(frm, res.message.original_tab_table || []);\r\n// //                             } else {\r\n// //                                 frappe.msgprint('âŒ No data found in latest Design Import.');\r\n// //                             }\r\n// //                         }\r\n// //                     });\r\n// //                 } else {\r\n// //                     frappe.msgprint(\"âš ï¸ No Design Import records found.\");\r\n// //                 }\r\n// //             }\r\n// //         });\r\n// //     }\r\n// // });\r\n\r\n// // function add_colors_to_bom(frm, color_rows) {\r\n// //     if (!color_rows.length) {\r\n// //         frappe.msgprint(\"âš ï¸ No rows found in Original Tab Table.\");\r\n// //         return;\r\n// //     }\r\n    \r\n// //     frm.clear_table(\"items\");\r\n// //     let added_count = 0;\r\n    \r\n// //     color_rows.forEach((row) => {\r\n// //         if (row.color_name) {\r\n// //             let child = frm.add_child(\"items\");\r\n// //             child.item_code = row.color_name;\r\n// //             child.qty = 1;\r\n// //             child.uom = \"Nos\";\r\n// //             child.rate = 0;\r\n            \r\n// //             // Fix: Use frappe.call instead of frappe.db.get_value for better compatibility\r\n// //             frappe.call({\r\n// //                 method: 'frappe.client.get_value',\r\n// //                 args: {\r\n// //                     doctype: 'Item',\r\n// //                     filters: {\r\n// //                         'name': row.color_name\r\n// //                     },\r\n// //                     fieldname: ['is_stock_item', 'stock_uom']\r\n// //                 },\r\n// //                 callback: function(r) {\r\n// //                     if (r.message) {\r\n// //                         if (r.message.is_stock_item !== undefined) {\r\n// //                             frappe.model.set_value(child.doctype, child.name, \"is_stock_item\", r.message.is_stock_item);\r\n// //                         }\r\n// //                         if (r.message.stock_uom) {\r\n// //                             frappe.model.set_value(child.doctype, child.name, \"uom\", r.message.stock_uom);\r\n// //                         }\r\n// //                     }\r\n// //                 }\r\n// //             });\r\n            \r\n// //             added_count++;\r\n// //         }\r\n// //     });\r\n    \r\n// //     frm.refresh_field(\"items\");\r\n// //     frappe.msgprint(`âœ… ${added_count} Color Samples added from latest Design Import.`);\r\n// // }\r\n\r\n\r\n\r\n\r\n\r\n// ---------------------------------sujal working script\r\n\r\n\r\n\r\n\r\n// Step 1: Debug Script - Find correct field name for Item Parameters\r\nfrappe.ui.form.on('BOM', {\r\n    debug_item_fields: function(frm) {\r\n        // First, let's check one of your items to find the correct field name\r\n        frappe.call({\r\n            method: 'frappe.client.get',\r\n            args: {\r\n                doctype: 'Item',\r\n                name: '300-HAND TUFTED-DESIGN 2-8X15-AE 08'  // Replace with any of your item codes\r\n            },\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    console.log(\"=== FULL ITEM DATA ===\");\r\n                    console.log(r.message);\r\n                    \r\n                    // Find all fields that might contain parameters\r\n                    let parameter_fields = [];\r\n                    Object.keys(r.message).forEach(key => {\r\n                        if (key.toLowerCase().includes('parameter')) {\r\n                            parameter_fields.push({\r\n                                field: key,\r\n                                data: r.message[key]\r\n                            });\r\n                        }\r\n                    });\r\n                    \r\n                    console.log(\"=== PARAMETER FIELDS FOUND ===\");\r\n                    console.log(parameter_fields);\r\n                    \r\n                    if (parameter_fields.length > 0) {\r\n                        parameter_fields.forEach(field => {\r\n                            console.log(`Field: ${field.field}`);\r\n                            console.log(`Data:`, field.data);\r\n                        });\r\n                    } else {\r\n                        console.log(\"âŒ No parameter fields found!\");\r\n                    }\r\n                } else {\r\n                    console.log(\"âŒ Item not found!\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n// Step 2: Modified Get Details Function with Dynamic Field Detection\r\nfrappe.ui.form.on('BOM', {\r\n    get_details: function(frm) {\r\n        frappe.call({\r\n            method: 'frappe.client.get_list',\r\n            args: {\r\n                doctype: 'Design Import',\r\n                fields: ['name'],\r\n                order_by: 'creation desc',\r\n                limit_page_length: 1\r\n            },\r\n            callback: function(r) {\r\n                if (r.message && r.message.length) {\r\n                    let latest_import = r.message[0].name;\r\n                    frappe.call({\r\n                        method: 'frappe.client.get',\r\n                        args: {\r\n                            doctype: 'Design Import',\r\n                            name: latest_import\r\n                        },\r\n                        callback: function(res) {\r\n                            if (res.message) {\r\n                                add_colors_to_bom_with_shade_matching_v2(frm, res.message.original_tab_table || []);\r\n                            } else {\r\n                                frappe.msgprint('âŒ No data found in latest Design Import.');\r\n                            }\r\n                        }\r\n                    });\r\n                } else {\r\n                    frappe.msgprint(\"âš ï¸ No Design Import records found.\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n// Step 3: Enhanced function with better field detection\r\nfunction get_all_shade_items_v2(callback) {\r\n    frappe.call({\r\n        method: 'frappe.client.get_list',\r\n        args: {\r\n            doctype: 'Item',\r\n            fields: ['name'],\r\n            limit_page_length: 0\r\n        },\r\n        callback: function(r) {\r\n            if (!r.message || r.message.length === 0) {\r\n                console.log(\"âŒ No items found\");\r\n                callback([]);\r\n                return;\r\n            }\r\n\r\n            console.log(`ðŸ“Š Total items to check: ${r.message.length}`);\r\n            let shade_items = [];\r\n            let processed = 0;\r\n\r\n            r.message.forEach((item, index) => {\r\n                frappe.call({\r\n                    method: 'frappe.client.get',\r\n                    args: {\r\n                        doctype: 'Item',\r\n                        name: item.name\r\n                    },\r\n                    callback: function(item_res) {\r\n                        processed++;\r\n                        \r\n                        if (item_res.message) {\r\n                            let item_doc = item_res.message;\r\n                            \r\n                            // Try multiple possible field names for item parameters\r\n                            let parameter_fields = [\r\n                                'custom_item_parameters',\r\n                                'item_parameters', \r\n                                'parameters',\r\n                                'item_parameter_table',\r\n                                'custom_parameters'\r\n                            ];\r\n                            \r\n                            let found_parameters = null;\r\n                            let used_field = '';\r\n                            \r\n                            // Check each possible field name\r\n                            for (let field of parameter_fields) {\r\n                                if (item_doc[field] && Array.isArray(item_doc[field]) && item_doc[field].length > 0) {\r\n                                    found_parameters = item_doc[field];\r\n                                    used_field = field;\r\n                                    break;\r\n                                }\r\n                            }\r\n                            \r\n                            if (found_parameters) {\r\n                                console.log(`âœ… Found parameters in item ${item.name} using field: ${used_field}`);\r\n                                \r\n                                // Find shade parameter\r\n                                let shade_param = found_parameters.find(param => \r\n                                    param.parameter && \r\n                                    param.parameter.toLowerCase().trim() === 'shade'\r\n                                );\r\n                                \r\n                                if (shade_param && shade_param.value) {\r\n                                    // If value is linked to MiscellaneousMst, get the actual value\r\n                                    frappe.call({\r\n                                        method: 'frappe.client.get_value',\r\n                                        args: {\r\n                                            doctype: 'MiscellaneousMst',\r\n                                            filters: { name: shade_param.value },\r\n                                            fieldname: 'value'\r\n                                        },\r\n                                        callback: function(misc_res) {\r\n                                            let final_shade_value = '';\r\n                                            \r\n                                            if (misc_res.message && misc_res.message.value) {\r\n                                                final_shade_value = misc_res.message.value;\r\n                                            } else {\r\n                                                final_shade_value = shade_param.value;\r\n                                            }\r\n                                            \r\n                                            shade_items.push({\r\n                                                name: item.name,\r\n                                                shade_value: final_shade_value.trim()\r\n                                            });\r\n                                            \r\n                                            console.log(`ðŸŽ¨ Found shade item: ${item.name} = ${final_shade_value}`);\r\n                                            \r\n                                            // If this is the last item, call callback\r\n                                            if (processed === r.message.length) {\r\n                                                console.log(`ðŸŽ¯ Total shade items found: ${shade_items.length}`);\r\n                                                console.log(\"Available shade values:\", shade_items.map(s => s.shade_value));\r\n                                                callback(shade_items);\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                } else {\r\n                                    // No shade parameter found in this item\r\n                                    if (processed === r.message.length) {\r\n                                        console.log(`ðŸŽ¯ Total shade items found: ${shade_items.length}`);\r\n                                        console.log(\"Available shade values:\", shade_items.map(s => s.shade_value));\r\n                                        callback(shade_items);\r\n                                    }\r\n                                }\r\n                            } else {\r\n                                // No parameters found in this item\r\n                                if (processed === r.message.length) {\r\n                                    console.log(`ðŸŽ¯ Total shade items found: ${shade_items.length}`);\r\n                                    console.log(\"Available shade values:\", shade_items.map(s => s.shade_value));\r\n                                    callback(shade_items);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            // Failed to get item details\r\n                            if (processed === r.message.length) {\r\n                                console.log(`ðŸŽ¯ Total shade items found: ${shade_items.length}`);\r\n                                console.log(\"Available shade values:\", shade_items.map(s => s.shade_value));\r\n                                callback(shade_items);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\n// Step 4: Enhanced matching function\r\nfunction add_colors_to_bom_with_shade_matching_v2(frm, color_rows) {\r\n    if (!color_rows.length) {\r\n        frappe.msgprint(\"âš ï¸ No rows found in Original Tab Table.\");\r\n        return;\r\n    }\r\n\r\n    console.log(\"=== DESIGN IMPORT COLOR ROWS ===\");\r\n    console.log(color_rows);\r\n\r\n    get_all_shade_items_v2(function(shade_items) {\r\n        if (shade_items.length === 0) {\r\n            frappe.msgprint(\"âŒ No Items found with 'Shade' parameter.\");\r\n            return;\r\n        }\r\n\r\n        frm.clear_table(\"items\");\r\n        let added_count = 0;\r\n        let not_matched = [];\r\n\r\n        color_rows.forEach((row) => {\r\n            if (row.color_name) {\r\n                let color_name = row.color_name.toString().trim();\r\n                console.log(`ðŸ” Looking for color: \"${color_name}\"`);\r\n                \r\n                // Find matching shade item\r\n                let matched_item = shade_items.find(shade_item => \r\n                    shade_item.shade_value.toLowerCase().trim() === color_name.toLowerCase().trim()\r\n                );\r\n\r\n                if (matched_item) {\r\n                    console.log(`âœ… Match found: ${color_name} â†’ ${matched_item.name}`);\r\n                    \r\n                    let child = frm.add_child(\"items\");\r\n                    child.item_code = matched_item.name;\r\n                    child.qty = 1;\r\n                    child.uom = \"Nos\";\r\n                    child.rate = 0;\r\n\r\n                    // Fetch stock info\r\n                    frappe.db.get_value(\"Item\", matched_item.name, \"is_stock_item\", (r) => {\r\n                        if (r && r.is_stock_item !== undefined) {\r\n                            frappe.model.set_value(child.doctype, child.name, \"is_stock_item\", r.is_stock_item);\r\n                        }\r\n                    });\r\n\r\n                    added_count++;\r\n                } else {\r\n                    console.log(`âŒ No match found for: \"${color_name}\"`);\r\n                    not_matched.push(color_name);\r\n                }\r\n            }\r\n        });\r\n\r\n        frm.refresh_field(\"items\");\r\n        \r\n        let message = `âœ… ${added_count} Items added with shade matching.`;\r\n        if (not_matched.length > 0) {\r\n            message += `\\nâš ï¸ No matching items found for: ${not_matched.join(', ')}`;\r\n        }\r\n        \r\n        frappe.msgprint(message);\r\n        \r\n        console.log(\"=== SUMMARY ===\");\r\n        console.log(`Added: ${added_count}`);\r\n        console.log(`Not matched:`, not_matched);\r\n        console.log(`Available shade values:`, shade_items.map(s => s.shade_value));\r\n    });\r\n}\r\n\r\n// Instructions for use:\r\n// 1. First run debug_item_fields to find correct field name\r\n// 2. Then use get_details as normal\r\n\r\n\r\n",
  "view": "Form"
 }
]