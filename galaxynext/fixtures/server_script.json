[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "After Submit",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-10-16 11:23:50.099770",
  "module": "galaxynext",
  "name": "company event",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Subcontracting Order",
  "script": "# # Script Type: Document Event\r\n# # Ref Doctype: Purchase Order\r\n# # Event: on_submit\r\n\r\n# if doc.is_internal_supplier:\r\n#     # Customer mapping\r\n#     customer = frappe.db.get_value(\"Customer\", {\"represents_company\": doc.company}, \"name\")\r\n#     if customer:\r\n#         so = frappe.new_doc(\"Sales Order\")\r\n#         so.customer = customer\r\n#         so.company = doc.represents_company\r\n#         so.transaction_date = doc.transaction_date\r\n#         so.delivery_date = doc.schedule_date\r\n\r\n#         # add items\r\n#         for item in doc.items:\r\n#             so.append(\"items\", {\r\n#                 \"item_code\": item.item_code,\r\n#                 \"qty\": item.qty,\r\n#                 \"rate\": item.rate,\r\n#                 \"warehouse\": frappe.db.get_value(\r\n#                     \"Item Default\",\r\n#                     {\"parent\": item.item_code, \"company\": doc.represents_company},\r\n#                     \"default_warehouse\"\r\n#                 )\r\n#             })\r\n\r\n#         so.flags.ignore_permissions = True\r\n#         so.insert()\r\n#         so.submit()\r\n\r\n#         frappe.msgprint(f\"Inter Company Sales Order {so.name} created for {customer}\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n# warehouse error\r\n\r\n\r\n\r\n# # Auto create Sales Order when Subcontracting Order is submitted\r\n# if doc.supplier:\r\n#     # find customer linked to this company\r\n#     customer = frappe.db.get_value(\r\n#         \"Customer\",\r\n#         {\"represents_company\": doc.company},\r\n#         \"name\"\r\n#     )\r\n\r\n#     if not customer:\r\n#         frappe.msgprint(f\"No Internal Customer found for Company: {doc.company}\")\r\n#     else:\r\n#         # find supplier's company\r\n#         supplier_company = frappe.db.get_value(\"Supplier\", doc.supplier, \"represents_company\")\r\n\r\n#         if not supplier_company:\r\n#             frappe.msgprint(\"Supplier is not linked to any company.\")\r\n#         else:\r\n#             # create Sales Order\r\n#             so = frappe.new_doc(\"Sales Order\")\r\n#             so.customer = customer\r\n#             so.company = supplier_company\r\n#             so.transaction_date = doc.transaction_date\r\n#             so.delivery_date = doc.schedule_date\r\n\r\n#             # map items from subcontracting order\r\n#             for item in doc.items:\r\n#                 so.append(\"items\", {\r\n#                     \"item_code\": item.item_code,\r\n#                     \"qty\": item.qty,\r\n#                     \"rate\": item.rate,\r\n#                     \"warehouse\": item.warehouse\r\n#                 })\r\n\r\n#             so.flags.ignore_permissions = True\r\n#             so.insert(ignore_permissions=True)\r\n#             so.submit()\r\n\r\n#             frappe.msgprint(f\"✅ Sales Order {so.name} auto-created from Subcontracting Order {doc.name}\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n# pefect code\r\n\r\n\r\n\r\n# # Auto create Sales Order when Subcontracting Order is submitted\r\n# if doc.supplier:\r\n#     # find customer linked to this company\r\n#     customer = frappe.db.get_value(\r\n#         \"Customer\",\r\n#         {\"represents_company\": doc.company},\r\n#         \"name\"\r\n#     )\r\n\r\n#     if not customer:\r\n#         frappe.msgprint(f\"No Internal Customer found for Company: {doc.company}\")\r\n#     else:\r\n#         # find supplier's company\r\n#         supplier_company = frappe.db.get_value(\"Supplier\", doc.supplier, \"represents_company\")\r\n\r\n#         if not supplier_company:\r\n#             frappe.msgprint(\"Supplier is not linked to any company.\")\r\n#         else:\r\n#             # create Sales Order\r\n#             so = frappe.new_doc(\"Sales Order\")\r\n#             so.customer = customer\r\n#             so.company = supplier_company\r\n#             so.transaction_date = doc.transaction_date\r\n#             so.delivery_date = doc.schedule_date\r\n\r\n#             for item in doc.items:\r\n#                 # check if warehouse belongs to correct company\r\n#                 wh_company = frappe.db.get_value(\"Warehouse\", item.warehouse, \"company\")\r\n\r\n#                 if wh_company != supplier_company:\r\n#                     # find default warehouse for supplier company\r\n#                     default_wh = frappe.db.get_value(\r\n#                         \"Warehouse\",\r\n#                         {\"company\": supplier_company, \"is_group\": 0},\r\n#                         \"name\"\r\n#                     )\r\n#                     frappe.msgprint(\r\n#                         f\"⚠️ Warehouse {item.warehouse} belongs to {wh_company}, \"\r\n#                         f\"auto-changed to {default_wh} for company {supplier_company}\"\r\n#                     )\r\n#                     warehouse_to_use = default_wh\r\n#                 else:\r\n#                     warehouse_to_use = item.warehouse\r\n\r\n#                 # append item with corrected warehouse\r\n#                 so.append(\"items\", {\r\n#                     \"item_code\": item.item_code,\r\n#                     \"qty\": item.qty,\r\n#                     \"rate\": item.rate,\r\n#                     \"warehouse\": warehouse_to_use\r\n#                 })\r\n\r\n#             so.flags.ignore_permissions = True\r\n#             so.insert(ignore_permissions=True)\r\n#             so.submit()\r\n\r\n#             frappe.msgprint(f\"✅ Sales Order {so.name} auto-created from Subcontracting Order {doc.name}\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n# # Auto create Sales Order when Subcontracting Order is submitted\r\n# if doc.supplier:\r\n#     # find customer linked to this company\r\n#     customer = frappe.db.get_value(\r\n#         \"Customer\",\r\n#         {\"represents_company\": doc.company},\r\n#         \"name\"\r\n#     )\r\n#     if not customer:\r\n#         frappe.msgprint(f\"No Internal Customer found for Company: {doc.company}\")\r\n#     else:\r\n#         # find supplier's company\r\n#         supplier_company = frappe.db.get_value(\"Supplier\", doc.supplier, \"represents_company\")\r\n#         if not supplier_company:\r\n#             frappe.msgprint(\"Supplier is not linked to any company.\")\r\n#         else:\r\n#             # create Sales Order\r\n#             so = frappe.new_doc(\"Sales Order\")\r\n#             so.customer = customer\r\n#             so.company = supplier_company\r\n#             so.transaction_date = doc.transaction_date\r\n#             so.delivery_date = doc.schedule_date\r\n            \r\n#             # Add items with correct warehouse for supplier company\r\n#             for item in doc.items:\r\n#                 # Get item's default warehouse for supplier company\r\n#                 item_default_wh = frappe.db.get_value(\r\n#                     \"Item Default\",\r\n#                     {\r\n#                         \"parent\": item.item_code,\r\n#                         \"company\": supplier_company\r\n#                     },\r\n#                     \"default_warehouse\"\r\n#                 )\r\n                \r\n#                 # Use item default warehouse if found, otherwise use original\r\n#                 warehouse_to_usew = item_default_wh if item_default_wh else item.warehouse\r\n                \r\n#                 so.append(\"items\", {\r\n#                     \"item_code\": item.item_code,\r\n#                     \"qty\": item.qty,\r\n#                     \"rate\": item.rate,\r\n#                     \"warehouse\": warehouse_to_use\r\n#                 })\r\n            \r\n#             so.flags.ignore_permissions = True\r\n#             so.insert(ignore_permissions=True)\r\n#             so.submit()\r\n#             frappe.msgprint(f\"✅ Sales Order {so.name} auto-created from Subcontracting Order {doc.name}\")\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n# Auto create Sales Order when Subcontracting Order is submitted\r\nif doc.supplier:\r\n    # find customer linked to this company\r\n    customer = frappe.db.get_value(\r\n        \"Customer\",\r\n        {\"represents_company\": doc.company},\r\n        \"name\"\r\n    )\r\n    if not customer:\r\n        frappe.msgprint(f\"No Internal Customer found for Company: {doc.company}\")\r\n    else:\r\n        # find supplier's company\r\n        supplier_company = frappe.db.get_value(\"Supplier\", doc.supplier, \"represents_company\")\r\n        if not supplier_company:\r\n            frappe.msgprint(\"Supplier is not linked to any company.\")\r\n        else:\r\n            # create Sales Order\r\n            so = frappe.new_doc(\"Sales Order\")\r\n            so.customer = customer\r\n            so.company = supplier_company\r\n            so.transaction_date = doc.transaction_date\r\n            so.delivery_date = doc.schedule_date\r\n            \r\n            # Add items with correct warehouse for supplier company\r\n            for item in doc.items:\r\n                # Get item's default warehouse for supplier company\r\n                item_default_wh = frappe.db.get_value(\r\n                    \"Item Default\",\r\n                    {\r\n                        \"parent\": item.item_code,\r\n                        \"company\": supplier_company\r\n                    },\r\n                    \"default_warehouse\"\r\n                )\r\n                \r\n                # ✅ Correct variable name (no extra 'w')\r\n                warehouse_to_use = item_default_wh if item_default_wh else item.warehouse\r\n                \r\n                # Append item to Sales Order\r\n                so.append(\"items\", {\r\n                    \"item_code\": item.item_code,\r\n                    \"qty\": item.qty,\r\n                    \"rate\": item.rate,\r\n                    \"warehouse\": warehouse_to_use\r\n                })\r\n            \r\n            so.flags.ignore_permissions = True\r\n            so.insert(ignore_permissions=True)\r\n            so.submit()\r\n            frappe.msgprint(f\"✅ Sales Order {so.name} auto-created from Subcontracting Order {doc.name}\")\r\n",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-29 10:40:08.603518",
  "module": null,
  "name": "testing server script",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "testing_script",
  "script": "# Generate short code from Title\r\nif doc.title:\r\n    words = doc.title.strip().split()\r\n    doc.short_code = \"\".join([w[0].upper() for w in words])\r\nelse:\r\n    frappe.throw(\"Title cannot be empty.\")",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-23 15:36:50.283711",
  "module": null,
  "name": "job card test server script",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Job Card",
  "script": "# Auto-fill Test Value 1 with uppercase of Test Value 2\r\nif doc.test_value_2:\r\n    doc.test_value_1 = doc.test_value_2.upper()\r\n\r\n# If both fields empty → set default\r\nif not doc.test_value_1 and not doc.test_value_2:\r\n    doc.test_value_1 = \"AUTO-GENERATED\"\r\n    doc.test_value_2 = \"demo\"\r\n\r\n# Show popup for testing\r\nfrappe.msgprint(f\"Job Card Server Script executed for: {doc.name}\")\r\n",
  "script_type": "DocType Event"
 }
]